\documentclass[twoside,english]{uiofysmaster/uiofysmaster}

\usepackage[toc,titletoc,title,page]{appendix} %to add appendices (and have them in toc)
\usepackage[utf8]{inputenc}
%\usepackage{mhchem} %latex chemistry symbols
\usepackage{blindtext} %to fill in dummy text
%\usepackage{cite} %to have multiple citations in one \cite{key1,key2,..} -do not use with natbib!!
\usepackage{tcolorbox} %to have boxes w color around text and math mode
\usepackage{enumitem} %to reduce vertical spacing in enumerate
\usepackage{tabu} % to set tables to page width
%\usepackage{aas_macros}

\usepackage[sort&compress,square,comma,numbers]{natbib} %to use \citet, now mixed with [nr]
\usepackage[nottoc]{tocbibind}

\usepackage{float} 
\usepackage[export]{adjustbox}
\usepackage{subcaption}
\newcommand{\blank}[1]{\hspace*{#1}} % move figures by \blank{}
\usepackage{pdfpages}
\usepackage{tikz}
\usetikzlibrary{
	arrows, 
	shapes.callouts,
	decorations.pathreplacing,
	decorations.pathmorphing,
	calc
}
\usepackage{stackengine}
\usepackage{revsymb} % used for lambda-bar

%---

\interfootnotelinepenalty=10000 % to force footnotes to NOT run over to the next page

%---
% to reduce space around table of contents (to fit everything into one page): 
\usepackage{tocloft}
\setlength{\cftbeforetoctitleskip}{0pt}
\setlength{\cftaftertoctitleskip}{0pt}
%---

\usepackage{epigraph}
\setlength\epigraphwidth{11cm}
\setlength\epigraphrule{0pt}

%---
\newcommand{\Sm}{$^{140}$Sm} % making it faster to write Sm140
\newcommand{\Pb}{$^{208}$Pb} 
\newcommand{\bd}{$\beta$-decay} % making it faster to write 
\newcommand{\ga}{$\gamma$}
\newcommand{\MBOU}{MAR\belowbaseline[-2pt]{a}B\stackinset{l}{3pt}{b}{-3pt}{O}{O}\,U}
\newcommand{\Ba}{$^{133}$Ba}
\newcommand{\Eu}{$^{152}$Eu}

%---
% modifying color in code listings and some style
%\usepackage{color}

% The predefined color names are: 
% black, blue, brown, cyan, darkgray, gray, green, lightgray, lime, magenta, olive, orange, pink, purple, red, teal, violet, white, yellow.
 
%\definecolor{codegreen}{rgb}{0,0.6,0} % too flashy
\definecolor{codegreen}{rgb}{0.0, 0.42, 0.24} % less flashy so comments not take all attention
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
%\definecolor{codepurple}{rgb}{1.0, 0.0, 0.22} %carminered, could try it 
%\definecolor{backcolour}{rgb}{0.95,0.95,0.92} % original suggestion
\definecolor{backcolour}{rgb}{0.94, 0.97, 1.0}% aliceblue, not so flashy and not as ugly
\definecolor{LightGray}{gray}{0.95}
 
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    %commentstyle=\color{codegray},    
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    %numbers=left,     %removing line numbers in the code snippets               
    %numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2,
    %float=tp,
    %floatplacement=tbp
}
 
\lstset{
	style=mystyle,
	literate={~} {$\sim$}{1}
}
\renewcommand{\lstlistingname}{Code}
%---

%---
% new tcolorbox environment
% #1: tcolorbox options
% #2: color
% #3: box title
\newtcolorbox{mybox}[3][]
{
  colframe = #2!25,
  colback  = #2!10,
  coltitle = #2!20!black,  
  title    = #3,
  #1,
}

%% Source: http://www.tedpavlic.com/post_preamble_for_journal_of_math_bio.php
%% We need to redefine \autoref. We should use 
%% abbreviations inside the sentence and full names 
%% at the beginning of sentences. Additionally,
%% need to handle the plural cases.

\newcommand*{\Appendixautorefname}{Appendix} % Add Appendix to \autoref 

% \Autoref is for the beginning of the sentence
%\let\orgautoref\autoref
%\providecommand{\Autoref}
%        {\def\equationautorefname{Equation}%
%         \def\figureautorefname{Figure}%
%         \def\subfigureautorefname{Figure}%
%         \def\sectionautorefname{Section}%
%         \def\subsectionautorefname{Section}%
%         \def\subsubsectionautorefname{Section}%
%         \def\Itemautorefname{Item}%
%         \def\tableautorefname{Table}%
%         \orgautoref}

% \Autorefs is plural for the beginning of the sentence
%\providecommand{\Autorefs}
%        {\def\equationautorefname{Equations}%
%         \def\figureautorefname{Figures}%
%         \def\subfigureautorefname{Figures}%
%         \def\sectionautorefname{Sections}%
%         \def\subsectionautorefname{Sections}%
%         \def\subsubsectionautorefname{Sections}%
%         \def\Itemautorefname{Items}%
%         \def\tableautorefname{Tables}%
%         \orgautoref}

% \autoref is used inside a sentence 
% (this is a renew of the standard)
% OBS! Note the "%" at the end of all lines. This is to prevent a leading space when using autoref.
\let\orgautoref\autoref
\renewcommand{\autoref}
        {%\def\equationautorefname{Eq.}%
		 %\def\figureautorefname{Fig.}%
	  	 % \def\subfigureautorefname{Fig.}%
		 \def\sectionautorefname{Section}% % \def\sectionautorefname{Sec.}%
		 \def\subsectionautorefname{Section}% % \def\subsectionautorefname{Sec.}%
		 \def\subsubsectionautorefname{Section}% % \def\subsubsectionautorefname{Sec.}%
		 % \def\Itemautorefname{item}%
		 % \def\tableautorefname{Tab.}%        
		 \def\chapterautorefname{Chapter}% large initial capital
          \orgautoref}

% \autorefs is plural for inside a sentence
%\providecommand{\autorefs}
%        {\def\equationautorefname{Eqs.}%
%         \def\figureautorefname{Figs.}%
%         \def\subfigureautorefname{Figs.}%
%         \def\sectionautorefname{Secs.}%
%         \def\subsectionautorefname{Secs.}%
%         \def\subsubsectionautorefname{Secs.}%
%         \def\Itemautorefname{items}%
%         \def\tableautorefname{Tabs.}%
%         \orgautoref}

% Make equations text be Eq. (ref)
\makeatletter
\def\tagform@#1{\maketag@@@{\ignorespaces#1\unskip\@@italiccorr}}
\let\orgtheequation\theequation
\def\theequation{(\orgtheequation)}
\makeatother

%% End of redefinition

%---


%\bibliography{references}

\author{Trond Wiggo Johansen}
\title{Coulomb excitation of neutron-deficient $\textnormal{\Sm}$}
\date{September 2019}
 
% ----------------------------------------------------------------------------------------------------------------------
% ----------------------------------------------------------------------------------------------------------------------
%Equations
%
%The command \eqref{} works exactly like \ref{}, but it adds parantheses to a plain number.
%
%Figures and tables
%
%\autoref{} is a usefull command when refering to to figures and tables. The command creates a reference with additional text corresponding to the target's type. For example, the command \autoref{fig:myfigure} would create a hyperlink to the \label{fig:myfigure} command, wherever it is. Assuming that this label is pointing to a figure, the hyperlink would contain the text "Figure 1.1", or similar.

%Two basic citation commands, \citet and \citep for textual and parenthetical citations, respectively. …
%\citet{jon90} --> Jones et al. (1990)
%\citep{jon90} --> (Jones et al., 1990)
%\citet*{jon90} --> Jones, Baker, and Williams (1990)
%\citep*{jon90} --> (Jones, Baker, and Williams, 1990)


\begin{document}

% set space around equations
\setlength{\belowdisplayskip}{12pt} \setlength{\belowdisplayshortskip}{12pt}
\setlength{\abovedisplayskip}{12pt} \setlength{\abovedisplayshortskip}{12pt}

\maketitle

%Centering the front page, see: https://github.com/ComputationalPhysics/uiofysmaster

%%% ABSTRACT
\begin{abstract}


\end{abstract}


\begin{dedication}
To my family, for all their love, support and encouragement!

\end{dedication}

\begin{acknowledgements}
Supervisors Professor Andreas Görgen and Dr. Katarzyna Hady{\'{n}}ska-Kl{\c{e}}k

Nuclear Physics Group

Computational Physics Group, Professor Morten Hjorth-Jensen

CERN-ISOLDE, Dr. Liam Gaffney

Ville Virtanen from University of Jyväskylä for helping me getting started on the scripts. 

Lillefy, FFU, Fysikkforeningen

My family

Morten, Alex and Astrid.

Ina, for pushing me towards excellence, I love you.

\subsection*{Collaboration details}


ENSAR2: European Nuclear Science and Applications Research - 2 \url{http://www.ensarfp7.eu}, UiO, ISOLDE, other contributors to the experiment?



  \vspace{1.5cm}
  
  \noindent\textit{Trond Wiggo Johansen}\\
  
  \noindent September, 2019


\vspace{1cm}

\begin{figure}[h]
	\begin{minipage}[b]{0.25\linewidth}
	\centering
		\includegraphics[width=\textwidth]{uiofysmaster/figures/apollonseglet/Apollonseglet/UiO_Segl_150dpi.png}
	\end{minipage}
	\hspace{4.8cm}
	\begin{minipage}[b]{0.45\linewidth}
	\centering
		\includegraphics[width=\textwidth]{Images/ISOLDE-logo.png}
	\end{minipage}
\end{figure}


\end{acknowledgements}


\tableofcontents

% ----------------------------------------------------------------------------------------------------------------------
% ----------------------------------------------------------------------------------------------------------------------

\chapter{Introduction}
\epigraph{\textit{"If you are not confused by quantum physics then you haven't really understood it."}}{\textit{– Niels Bohr}}


The atom was long believed to be the smallest unit of matter, but now we know that this is not true, we have subatomic particles. 
In the early 1800s, the first evidence-based theories started to be developed around the atom.
Still, it would take almost 100 years before an atom model was proposed and the nucleus was discovered. 
In 1911, the famous Rutherford experiment took place.
The experiment was the bombardment of $\alpha$-particles into a gold (metal) foil, to observe how the particles scattered.
It was conducted by Hans Geiger and Ernest Marsden at the suggestion of Ernest Rutherford.
Rutherford, Geiger and Marsden, expected the particles to pass straight through, with little deflection. 
They were surprised when this did not happen, and the explanation was that there was a positively charged nucleus at the center of the atom. 
In 1913, Niels Bohr proposed his model of the atom, laying the basis of atomic theory.
As late as 1932, the neutron was discovered by James Chadwick. 

The atomic shell model can explain the complicated details of atomic structure.
In the atomic shell model, the electron shells are filled with electrons in order of increasing energy.
By studying the ionization energy of electrons, a clear indication for "magic" numbers at 2, 8, 10, 18, 36, 54 and 86 was obtained \cite{Heyde}. 
These numbers correspond to the noble gases in the periodic table.

Nuclear physics is the study of atomic nuclei. 
The nucleus consists of positively charged protons and uncharged neutrons, together called nucleons. 
In nuclear physics, an analogous model to the atomic shell model is used to explain nuclear structure.
This model is called the nuclear shell model. 
In the nuclear shell model, nucleons (protons or neutrons) are filled into shells in order of increasing energy. 
The shells of protons and neutrons are independent of each other. 

The magic numbers in the nuclear shell model are for the protons ($Z$) and neutrons ($N$) individually
\begin{align*}
	Z &= \{ 2, ~8, ~20, ~28, ~50, ~82 \} \\
	N &= \{ 2, ~8, ~20, ~28, ~50, ~82, ~126 \}
\end{align*}
These series of numbers corresponds to the filling of shells.
They are one of the main features that shell structure is built upon. 
A single closed shell nucleus is a nucleus where either $Z$ or $N$ are a magic number, while for a doubly closed shell nucleus both $Z$ and $N$ are magic numbers. 
These nuclei have an extra binding energy compared to the predictions of the semi-empirical mass formula \cite{NR}.

Maria Goeppert Mayer discovered the magic numbers around 1945 from observation of periodicity in binding energy. 
She gave Walter Maurice Elsasser credits for being the first to remark that such numbers exists, from an article he wrote in 1933. 
Eugene Wigner believed in the liquid drop model and did not trust the new theory. 
He called these numbers "magic" \cite{Mayer1964, MIT-OCW}. 
The reason why the numbers are called magic numbers, is that a magic number of protons or neutrons makes the nucleus unusually stable compared to the neighboring non-magic nuclei \cite{Mayer1964}. 
\textcolor{red}{er alle magiske mer stabile, eller finnes det unntak her? mener å huske det var en diskusjon om dette på pauserommet på kjernefysikk en gang, men husker ikke hva konklusjonen var. Hva med Ni-56, Ni-78, Sn-100 og Sn-132 som er dobbelt magiske og radioaktive?}


There are many different ways of describing various properties of nuclei, e.g. radius, mass, binding energy, spin, parity, electromagnetic moments and excited states.
There are both macroscopic and microscopic models, such as the liquid drop model and the shell model. 

This thesis will not go into details about the liquid drop model, the nuclear shell model or other nuclear models, because there is no comparison of the data to any theoretical models.
Some models will be mentioned in order to explain other phenomena.
Extensive descriptions of the liquid drop model, the semi-empirical mass formula and the shell model can be found in \cite{Krane}.


\textcolor{red}{spin and parity?}

\textcolor{red}{Må jeg nå, siden jeg har nevnt disse modellene, skrive kort hva de omhandler?}


%The Pauli exclusion principle declares that "two identical fermions cannot occupy the same state". \cite{Griffiths}


\section{Nomenclature}
This section will explain the different symbols and units used throughout the thesis.

Isotopes are atoms of the same chemical element that differ in the number of nucleons.
The isotope notation is as follows
\begin{align*}
	^A_Z\text{X}_N^q
\end{align*}
where $X$ is the chemical symbol of the element, $A = Z + N$ is the mass number (the number of nucleons), $Z$ is the proton number, $N$ is the neutron number and $q$ is the charge where $q = Z$ protons $- ~i$ electrons. 

\autoref{tab:units} shows the physical constants and energy equivalents, their SI units and their SI derived units, and
\autoref{tab:SI-prefixes} shows the metric SI prefixes.
SI, abbreviated from the French Le Syst{\`{e}}me International d'Unit{\'{e}}s, is The International System of Units, which is built upon seven base units.
When mentioning the mass of a particle, it is usually given in units of atomic mass unit $u$.
The energy is usually given in $\frac{\text{MeV}}{\text{u}}$ or $\frac{\text{MeV}}{\text{u}}$.
This comes from 
\begin{align}
	\frac{\text{MeV}}{\text{A}} &= \frac{\text{MeV}}{\text{A}}  \frac{\text{A}}{\text{u}} = \frac{\text{MeV}}{\text{u}}  &  1 ~\text{A} &= 1 ~\text{u} \implies 1 = \frac{\text{A}}{\text{u}}
\end{align}

\begin{table}[htb] 
    \centering 
    \caption{Values of the fundamental physical constants and energy equivalents from the National Institute of Standards and Technology (NIST) Physics Laboratory \cite{units}.}
	\input{Table-data/Units.tex}
	\label{tab:units}
\end{table}

\begin{table}[htb] 
    \centering 
    \caption{Metric SI prefixes from the National Institute of Standards and Technology (NIST) Physics Laboratory \cite{units}.}
	\input{Table-data/SI-prefixes.tex}
	\label{tab:SI-prefixes}
\end{table}


\section{Motivation for the experiment}

A similar experiment, with experiment code IS495 titled Coulomb excitation of \Sm, was conducted in 2012 at CERN-ISOLDE.
The old REX-ISOLDE post-accelerator was limited to a beam energy of 2.85 MeV/u for \Sm\ (samarium), which gave a low Coulomb excitation cross section and a low probability for multi-step excitations. 
Therefore, a secondary target of $^{94}_{42}$Mo$_{52}$ (molybdenum) with a thickness of 2 mg/cm$^2$ was chosen to maximize the cross section at this energy.
An excitation cross section is the probability of an excitation process occurring.
Excited states up to 1256 keV were populated.
One goal of the experiment was to deduce the $B(E2)$ values and quadrupole moments of low-lying states in neutron-deficient \Sm\ using multi-step Coulomb excitation.
Another goal was to normalize the $B(E2; 0^+ \rightarrow 2^+)$ value in \Sm\ to the well-known $B(E2)$ value for the Mo target, that is the transition strengths in the excited $^{94}$Mo target.
Out of that experiment (and another experiment) came a PhD thesis by Malin Klintefjord, titled Evolution of deformation and collectivity away from magic numbers \cite{Klintefjord}, in addition to three articles \cite{Klintefjord2015, Samorajczyk2015, Klintefjord2016} on \Sm.

In the experiment in 2012, previously unknown transition strengths between low-lying states in \Sm\ was extracted. 
\ga\ intensities as a function of particle scattering angle was studied to get information about the first excited $2^+$ state.
\Sm\ was thought to have a low-lying $0^+$ state \cite{Firestone}, but this state was shown to be $2^+$ \cite{Samorajczyk2015}. 
The results of the experiment indicated a weak quadrupole deformation with a strong triaxiality and \ga-softness.

In 2017, there was an upgrade of the ISOLDE facility, which lead to the possibility of delivering beam energies up to 7.5 MeV/u. 
This allows for Coulomb excitation of \Sm\ at higher energies than the previous experiment.
In turn, this implied that it was possible to choose a high-$Z$ target (Pb) to give a high COULomb EXcitation (COULEX) cross section, especially for multi-step.
A beam energy of 4.7 MeV/u was chosen as the highest possible energy for safe COULEX for Pb.
COULEX will be discussed in \autoref{sec:Coulex}.
Excited states up to at least the $8^+$ state at 2970 keV are expected to be populated with this energy.
Maybe also currently unknown states will be populated.
This will give a greater understanding of the low-lying nuclear structure in \Sm.
With a new experiment, it will also be easier to interpret the nuclear shape of \Sm.

For the present experiment, no normalization of the transition probabilities were required.
From the previous experiment \cite{Klintefjord2016} and from lifetime measurements \cite{BelloGarrote2015}, the $B(E2, 0_1^+ \rightarrow 2_1^+$) value of \Sm\ was obtained. 
This can be used to normalize the transition probabilities for the higher-lying transitions.

The goal of the master thesis is to analyze the data from the experiment which was conducted between 8th and 14th of August in 2017.  
The experiment from 2017 had the experiment code IS558 and was titled Shape Transition and Coexistence in Neutron-Deficient Rare Earth Isotopes.
Samarium (Sm) comes from the lanthanide series of chemical elements, which are known as rare-earth elements.
\Sm\ is a radioactive isotope with a ground state half-life ($T_{1/2}$) of 14.82 min. 
It is a neutron-deficient nuclei close to the proton drip line.

The nucleus can have many different shapes, and this experiment is related to the shapes of the nucleus. 
\autoref{fig:Nuclear-shapes} shows a sketch of three different nuclear shapes. 
\autoref{sec:shapes} will discuss different nuclear shapes.

\begin{figure}[htb]
	\centering
	\includegraphics[width=0.8\textwidth]{Images/nuclear-shapes-v2.png}
	\caption{Nuclear shapes, adapted from \cite{MSU-shapes}. 
	(a) The shape of a prolate derformed nucleus looks like an American football, while the shape of (b) an oblate deformed nucleus looks like a pumpkin and (c) a triaxial deformed nucleus looks like a kiwi fruit.}
	\label{fig:Nuclear-shapes}
\end{figure}

The shape of an atomic nucleus is determined by macroscopic and microscopic effects. 
Nuclei with filled proton or neutron shells, that is magic nuclei, generally have a spherical shape, while nuclei with open shells gain energy by taking on a deformed shape.
Deformation leads to a more stable nucleus.
The shape of the nucleus can change drastically by adding or removing protons or neutrons.
Some nuclei exhibit what is called shape coexistence, that is the coexistence of quantum states that correspond to different shapes.
Shape coexistence is often found near closed shells. 
A typical indication for shape coexistence is $0^+$ states often at low energy. 
$^{140}_{~62}$Sm$_{78}$ is just below the $N = 82$ shell closure, with a $Z = 62$ mid shell. 
There is an indication of $0^+$ states around 1.5 MeV. 
One object of this experiment is to clarify the nature/structure of these $0^+$ states. 
The underlying nuclear structure of nuclei are used as benchmarks for theoretical models.

\autoref{fig:cea_CoN} displays the chart of nuclides for deformed nuclei. 
The red lines in the figure corresponds to the magic numbers (the filling of shells). 
Around the red lines, the nuclei are marked with a gray color, meaning that there is no deformation. 
Between the red lines, where the shells are not filled, or half-filled, the nuclei are deformed and marked by a different color than gray. 

Nuclei in the rare-earth region, especially the samarium (Sm) isotopes, exhibits a veriety of shape effects. 
The Sm isotope $^{144}_{~62}$Sm$_{82}$ has a closed neutron shell, and has a spherical shape.
By adding neutrons to $^{144}$Sm, the deformation changes to an elongated (prolate) quadrupole shape. 
\textcolor{blue}{A transition from spherical to prolate deformed implies a shape-phase transition, a so-called critical point symmetry.} \textcolor{red}{Beveger jeg meg ut på farlige områder med denne setningen? Jeg har ikke eksplisitt nevnt X(5), men det er det det er...}
\autoref{fig:Sm-shapes} shows that theory predicts a transition from spherical to prolate shapes occurs in the Sm isotopes between $N = 82$ and $N = 94$.
Theory also predicts that a flattened (oblate) quadrupole shapes occur below the $N = 82$ shell closure. 
Taking out more neutrons going to very neutron-deficient Sm nuclei, e.g. $^{132}$Sm, are also prolate deformed. 
Shape coexistence is possible for certain regions of $N$ and $Z$.
An earlier experiment studying \Sm\ at CERN-ISOLDE found a triaxial shape for this isotope, that is a shape where all three principal axis of the ellipsoid have different lengths.
\Sm\ can therefore be considered to lie at the critical point of a phase-shape transition from spherical to deformed, and from prolate to oblate shape.
\textcolor{blue}{In the previous experiment, there was an indication for triaxiality/\ga-softness \cite{Klintefjord} for \Sm, another form of shape-phase transition / critical point behavior, E(5) \cite{Iachello2000}. 
\Sm\ could be one of the best examples of E(5) symmetry, need transition probabilities from higher-lying states to confirm.} \textcolor{red}{Denne må vel bort? Ellers er jeg ute å kjøre i teoriland...}
Transition probabilities and quadrupole moments between several excited states in \Sm\ are still unknown.

\begin{figure}[ht]
	\centering
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[width=0.9\textwidth]{Images/cea-CoN-adjusted.png}
		\caption{}
		\label{fig:cea_CoN}
	\end{subfigure}
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[width=\textwidth]{Images/Sm-shapes.png}
		\caption{}
		\label{fig:Sm-shapes}
	\end{subfigure}
	\caption{(a) Chart of nuclides for deformed nuclei, adapted from \cite{Hilaire2007, CEA}. \Sm\ is inside the pink ring, to the left of the yellow square.
	 (b) Sm shape transitions of even-even nuclei based on \cite{Hilaire2007, CEA}.
	 }
	\label{fig:deformation}
\end{figure}



% ----------------------------------------------------------------------------------------------------------------------
% ----------------------------------------------------------------------------------------------------------------------

\chapter{Theory}\label{ch:theory}
\epigraph{\textit{"I think I can safely say that nobody understands quantum mechanics."}}{\textit{– Richard Feynman}}


\section{Nuclear shapes}\label{sec:shapes}

\subsection{Nuclear deformation}
A way to understand nuclear deformation is to imagine a liquid drop vibrating \textcolor{red}{??? and/or rotating ???} at \textcolor{red}{??? high / a ???} frequency. 
In this imagined picture, the average shape of the liquid drop nucleus is spherical, but the instantaneous shape is not.
\autoref{fig:vibrating-nucleus} displays a sketch of a deformed vibrating nucleus.
One way to parameterize the instantaneous surface of the nucleus is to describe it by a vector \textbf{R} pointing from the origin to a surface point given by the angles $\theta$ and $\phi$ \cite{Krane}.
This is called the multipole expansion, and is given by the following equation
\begin{equation}\label{eq:Rfull}
	\mathbf{R}(\theta, \phi) = R_0 \left( 1 + a_{00} + \sum^\infty_{\lambda = 1} \sum^{+\lambda}_{\mu = -\lambda} a_{\lambda \mu} Y_{\lambda \mu}(\theta, \phi) \right)
\end{equation}
where $R_0$ is the radius of the sphere, $a_{00}$ describes volume changes, $a_{\lambda \mu}$ are the expansion coefficients, or the deformation parameters. 
The parametrization involves the spherical harmonics $Y_{\lambda \mu}$, where $\lambda$ is the multipole, $\mu$ is the order of the expansion and $\theta$ and $\phi$ are the intrinsic angles \cite{Krane, RS, Klintefjord}. 

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\textwidth]{Images/vibrating-nucleus.png}
	\caption{A deformed vibrating nucleus, adapted from \cite{Krane}. In the drawing, the dotted lines represent the spherical equilibrium shape. The drawing is an exaggeration of reality, because exaggeration \textcolor{red}{??? promotes / develops ???} \textcolor{red}{??? understanding / knowledge ???}. See text for more information. \textcolor{red}{det jeg prøvde å si var: fordi overdrivelse fremmer forståelse.}}
	\label{fig:vibrating-nucleus}
\end{figure}

By assuming incompressibility of the nucleus, the volume is kept constant as
\begin{align*}
	V = \frac{4}{3} \pi R_0^3
\end{align*}
Further we have that
\begin{equation}\label{eq:radius}
	R_0 = r_0 A^{1/3}
\end{equation}
where $r_0 \approx 1.25$ fm and $A$ is the mass number of the nucleus.

The expansion coefficients, $a_{\lambda \mu}$, can be time dependent and can thus describe a vibration or rotation in space of the nucleus. 
By reflection symmetry, the expansion coefficients are required to keep the equality $a_{\lambda \mu} = a_{\lambda, -\mu}$ \cite{Krane}.
Up to second order, the expansion coefficients are given as
\begin{equation}
	a_{00} = -\frac{1}{4\pi} \sum_{\lambda > 1, \mu} | a_{\lambda\mu} |^2
\end{equation}

A dipole vibration, $\lambda = 1$, describes a translation of the whole system, and this is not very interesting in it self. 
Translational motion describes the motion of a system. 
By putting the origin of the coordinate system in the center of mass, it is possible to fix and exclude the $a_{1\mu}$ parameters, and thus also $a_{00}$ \cite{RS}. 
If we restrict the system to small deformations, we get that $a_{1\mu} = 0$ and thus $a_{00} = 0$.
\autoref{eq:Rfull} is then reduced to
\begin{equation}\label{eq:Rmid}
	\mathbf{R}(\theta, \phi) = R_0 \left( 1 +  \sum^\infty_{\lambda = 2} \sum^{+\lambda}_{\mu = -\lambda} a_{\lambda \mu} Y_{\lambda \mu}(\theta, \phi) \right)
\end{equation}

Another condition is that $\textcolor{red}{??? R / \mathbf{R} ???}$ should be invariant under reflection and rotation of the coordinate system, that is, $R$ should be unchanged by transformations of the coordinate system.
By further choosing the $z$-axis as symmetry axis, we end up in a special case where all $a_{\lambda \mu}$ vanishes except when $\mu = 0$. 
This is the assumption of axial symmetry.
The special parameters, $a_{\lambda 0}$, are called $\beta_2$.

\autoref{fig:vibrational-modes} shows a sketch of the three lowest \textcolor{red}{possible?} vibrational modes. 
The quadrupole vibration, $\lambda = 2$, is the most important mode.
It describes the shape of the nucleus and is the dominant feature in most of the (\textcolor{red}{deformed?}) nuclei. 
With low multipolarity, the quadrupole vibration is the first available vibrational mode for low-energy excitation in nuclei.
In almost all even-even nuclei there is a low-lying state with $J^\pi = 2^+$, and near closed shells it is possible to distinguish the second harmonic states as well ($J^\pi = 0^+, 2^+, 4^+$). 
\textcolor{red}{Hvorfor blir spinnene dette igjen?}

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\textwidth]{Images/vibration-modes-3.png}
	\caption{Vibrational modes, adapted from \cite{Krane}. The dotted lines represent the spherical equilibrium shape.
	(a) Dipole, $\lambda = 1$. 
	(b) Quadrupole, $\lambda = 2$. 
	(c) Octupole, $\lambda = 3$.}
	\label{fig:vibrational-modes}
\end{figure}
%(d) Hexadecapole, $\lambda = 4$, $a_{40} > 0$. \cite{RS}
%(e) Hexadecapole, $\lambda = 4$, $a_{40} < 0$.

For $\lambda = 2$, there are five parameters of $a_{2\mu}$ ($\mu \in \{ -2, -1, 0, 1, 2 \}$). 
Two parameters describe the shape, and in addition there are three parameters describing the orientation in space. %(Euler angles $\Omega = (\alpha, \beta, \gamma)$). 
It is possible to align the deformed shape in a coordinate system such that only two parameters are needed to describe the shape of the nucleus.
With a suitable rotation, we can achieve 
\begin{align*}
	a_{21} &=  a_{2,-1} = 0 \\
	a_{22} &= a_{2,-2} 
\end{align*}
leaving two independent parameters, $a_{20}$ and $a_{22}$. 
With Hill-Wheeler \cite{Hill-Wheeler} coordinates ($\beta$, $\gamma$) they become
\begin{align}
	a_{20} &= \beta \cos \gamma \label{eq:a-param1} \\
	a_{22} &= \frac{1}{\sqrt{2}} \beta \sin \gamma \label{eq:a-param2}
\end{align}
where $\beta$ is axial deformation (deformation magnitude) and $\gamma$ is triaxial deformation (shape parameter). 
$\gamma = 0$ and $\beta > 0$ corresponds to  the prolate deformed shape, while $\gamma = 0$ and $\beta < 0$ corresponds to the oblate shape. 
The triaxial shape is obtained when $0 < \gamma < \tfrac{\pi}{3}$.
Further we have
\begin{equation}
	\sum_\mu | a_{2\mu} |^2 = a_{20}^2 + 2a_{22}^2 = \beta^2
\end{equation}
In the special case when $\lambda = 2$, \autoref{eq:Rmid} becomes
\begin{equation}
	\mathbf{R}(\theta, \phi) = R_0 \left( 1 + \beta \sqrt{\frac{5}{16\pi}} (\cos \gamma (3\cos^2 \theta - 1) + \sqrt{3} \sin \gamma \sin^2 \theta \cos 2\phi) \right)
\end{equation}
by using the spherical harmonics $Y_{20}$ and $Y_{2,\pm 2}$ \cite{RS}.

\textcolor{red}{finn en måte å inkludere \autoref{fig:cea_tri} + forklare \ga-soft.}

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.7\textwidth]{Images/Triaxial-map-drawing.png}
	\caption{Potential energy surface for \Sm, adapted from \cite{Hilaire2007, CEA}. \textcolor{red}{\Sm\ looks like a so-called \ga-soft vibrator? See lecture FYS4570 18. Sept 2018.}}
	\label{fig:cea_tri}
\end{figure}

Octupole vibration, $\lambda = 3$, with $J^\pi = 3^-$ can be seen in many nuclei.
In nuclei where the shell structure makes the quadrupole modes occur at very high energies, such as in doubly magic nuclei, the octupole state is often the lowest excited state.
The octupole deformation has a pear shape.



\section{The Coulomb excitation method}\label{sec:Coulex}
COULomb EXcitation (COULEX) is an experimental method to excite a nucleus by an inelastic scattering with another nucleus through the electromagnetic interaction. 
The elastic Coulomb scattering process is also known as Rutherford scattering.
Inelastic Coulomb scattering is called Coulomb excitation.
This method is very useful for studying collective excitations and shapes of nuclei, as they are often connected by electric quadrupole transitions.  
Transition energies and intensities can be used to determine new excited levels and study deformation.
An extensive description of Coulomb excitation can be found in \cite{Alder1956, EE-Coulex, Bertulani2009}.

\autoref{fig:scattering} shows sketches of the scattering process in the LABoratory (LAB) and Center of Mass (CM) frame of reference. 
In the LAB frame, a beam particle approaches the target with a velocity $\mathbf{u}$ in a straight line in the absence of the repulsive force. 
The beam particle gets excited by the electromagnetic interaction with the target particle. 
This excitation is an unstable energy state and soon thereafter it will de-excite, sending out a \ga-ray.
Both the beam and target particles are scattered with a velocity $\mathbf{v}_b$ and $\mathbf{v}_t$ respectively.
The distance, $b$, is called the impact parameter and is the vertical distance between the beam and target particle. 
The angles $\theta_b$ and $\theta_t$ are the scattering angles for the beam and target particle, respectively. 
$V_{cm}$ is the center of mass velocity. 
A small angle $\theta_b$ means forward scattering of the beam, a larger distance between the beam particle and the target particle, a weaker electromagnetic (EM) field and less excitation probability. 
A large angle $\theta_b$ means backward scattering of the beam, a closer distance between the beam particle and the target particle, a stronger EM field and higher excitation probability.
In the CM frame, the center of mass velocity is zero, and the velocities and angles are marked by an apostrophe to separate between the two frames of reference.
\autoref{tab:scattering} shows the corresponding scattering angles from the reaction. 
The Coulomb scattering kinematics can be approximated by an elastic collision.
In \autoref{ch:scattering}, a calculation of the two-particle elastic collision is performed.

\begin{figure}[htb]
	\centering
	\includegraphics[width=\textwidth]{Images/scattering.png}
	\caption{Scattering in different frames of reference.
	(a) Scattering in the LABoratory (LAB) frame. 
	(b) Scattering in the Center of Mass (CM) frame. 
	See text for more information.}
	\label{fig:scattering}
\end{figure}

%\begin{figure}[ht]
%	\centering
%	\begin{subfigure}{\textwidth}
%		\input{Images/LAB-frame.tikz}
%		\caption{}
%		\label{fig:LAB}
%	\end{subfigure}
%	\begin{subfigure}{\textwidth}
%		\input{Images/CM-frame.tikz}
%		\caption{}
%		\label{fig:CM}
%	\end{subfigure}
%	\caption{Scattering in different frames of reference.
%	(a) Scattering in the LABoratory (LAB) frame. A small angle $\theta_b$ means forward scattering of the beam, a larger distance between the beam particle and the target particle, a weaker electromagnetic (EM) field and less excitation probability. A large angle $\theta_b$ means backward scattering of the beam, a closer distance between the beam particle and the target particle, a stronger EM field and a higher excitation probability.
%	(b) Scattering in the Center of Mass (CM) frame.}
%	\label{fig:LAB-CM}
%\end{figure}

\begin{table}[htb] 
    \centering 
    \caption{Scattering of \Sm\ on \Pb\ with beam energy 4.65 MeV/u.
    Calculations are done with the LISE++ \cite{LISE} kinematics calculator with a reaction from the middle of the target.
    The LAB and CM frame angles are based on the LAB input angles from $\theta_b$ and $\theta_t$. 
    In (b) there are angles marked with red color. 
    These are overlapping with the CM angles in (a), making a total of 24 unique angles in the CM frame.}
	\label{tab:scattering}
    \begin{subtable}{0.45\textwidth}
    		\centering
		\caption{$\theta_b \in [22.0^\circ, 56.7^\circ]$.}
	 	\label{tab:LABvsCM_b}
	 	\input{Table-data/LABvsCM_b.tex}
	\end{subtable}
	\begin{subtable}{0.45\textwidth}
		\centering
		\caption{$\theta_t \in [22.0^\circ, 56.7^\circ]$.}
		\label{tab:LABvsCM_t}
		\input{Table-data/LABvsCM_t.tex}
	\end{subtable}
\end{table}

\subsubsection*{\textcolor{red}{Burde jeg brukt projectile and target under her?}}

In the semi-classical approach of Coulomb excitation theory, the projectile (beam) and target is assumed to move on hyperbolic paths. 
This approach does not take into account the energy loss during the excitation process.
When the beam particle approaches the target particle, the beam particle reaches a minimum separation distance, $d$, which is dependent on the impact parameter $b$. 
The distance of closest approach, $d$, is the distance between the center of both nuclei. 
In a head-on collision, $b = 0$ and the particles reach the distance of closest approach $d$, which is given by
\begin{equation}
	d\left( \theta_b^{'} \right) = a \left( 1 + \csc \left( \frac{\theta_b^{'}}{2} \right) \right) = a \left( 1 + \frac{1}{\sin \left( \frac{\theta_b^{'}}{2} \right)} \right) ~[\text{fm}]
\end{equation}
The scattering angle of the beam in the CM frame is $\theta_b^{'}$.
Half the distance of closest approach, $a$, in a head-on collision ($\theta_b^{'} = 180^\circ$) is given by
\begin{equation}
	 a = \tfrac{1}{2} d = \frac{Z_b Z_t e^2}{m_r v_i^2} ~[\text{fm}]
\end{equation}
$Z_b$ and $Z_t$ is the proton number of the beam and target, respectively. 
The elementary charge is $e$, the initial velocity of the beam is $v_i$ and $m_r$ is the reduced mass of the beam and target given by
\begin{align}
	 m_r &= m_b \frac{A_b A_t}{A_b + A_t} = m_b A_r  ~\left[ \tfrac{\text{MeV}}{\text{c}^2} \right]
	 &
	 A_r &= \frac{A_b A_t}{A_b + A_t}
\end{align}
where $m_b$ is the mass of the beam particle, and $A_r$ is the reduced mass number of the beam and target \cite{RBass, EE-Coulex}. 
The impact parameter can be expressed as
\begin{equation}
	b = a \cot \left( \tfrac{\theta_b^{'}}{2} \right)
\end{equation}

One requirement in the semi-classical approach is that the asymptotic wavelength of relative motion of the beam, that is the de Broglie wavelength ${\lambdabar = \hbar/m_r v_i}$, must be small compared to the distance of closest approach, $d$ \cite{RBass, EE-Coulex}.
The ratio of half the distance of closest approach and the de Broglie wavelength defines the Sommerfeld parameter, $\eta$, which measures the strength of the Coulomb interaction \cite{Cline1969}.
It is given by
\begin{equation}
	\eta = \frac{d}{2\lambdabar} = \frac{a}{\lambdabar} = \frac{Z_b Z_t e^2}{m_r v_i^2} = \frac{Z_b Z_t e^2}{\hbar v_i} \approx 0.72 \frac{Z_b Z_t}{A_r E_b}
\end{equation}
where $E_b = \tfrac{1}{2} m_b v_i^2$ is the initial kinetic energy of the beam given in MeV/u \cite{RBass}.
A principal assumption for describing the relative motion of the particles in the CM frame by hyperbolic paths is that $\eta \gg 1$.
In the semi-classical approach, this is fairly accurate \cite{Cline1969}. 
The factor 0.72 comes from 
\begin{align}
	\frac{e^2}{2} = \frac{(\sqrt{1.4399764 ~[\text{MeV} \cdot \text{fm}]})^2}{2} \approx 0.72 ~[\text{MeV} \cdot \text{fm}]
\end{align}

Another important parameter is the adiabaticity parameter, $\xi$, which is given by 
\begin{equation}
	\xi = \frac{a}{\hbar v_i}  \Delta E = \frac{Z_b Z_t e^2}{\hbar v_i} \cdot \frac{\Delta E}{2E_b} = \eta \cdot \frac{\Delta E}{2E_b}
\end{equation}
The probability of exciting the nucleus from a initial state $|i\rangle$ to a final state $|f\rangle$ with excitation energy difference $\Delta E = E_f - E_i$ is dependent on the adiabaticity parameter \cite{Niedermaier, NaR, RBass}.
If $\xi \ll 1$ the reaction process is sudden and the excitation probability is largest, while if $\xi \gg 1$ the reaction becomes adiabatic, which means that the reaction process becomes hindered. 
The excitation probability decreases exponentially with increasing $\xi$. 
A semi-classical approach of the Coulomb excitation is a good approximation if the conditions $\eta \gg 1$ and $\xi \ll 1$ are fulfilled.
This means that the energy transfer has negligible influence of the motion and thus  
\begin{equation}
	\frac{\Delta E}{E_b} \ll 1
\end{equation}
which will not hold for all states $|f\rangle$.
The conditions are fulfilled for states with a considerable excitation probability \cite{EE-Coulex, RBass}.

For point-like charges, the differential scattering cross section, $d\sigma_R$, is given by the the classical Rutherford formula
\begin{align}
	\frac{d\sigma_R}{d\Omega} 
	&= \frac{a^2}{4 \sin \left( \tfrac{\theta_b^{'}}{2} \right)} \nonumber \\
	&= \left( \frac{Z_b Z_t e^2}{4\pi \varepsilon_0}  \right)^2 \left( \frac{1}{4 E_b}  \right)^2 \cdot \frac{1}{\sin^4 \left( \frac{\theta_b^{'}}{2} \right)} \nonumber \\	
	&= \left( \frac{Z_b Z_t e^2}{8 \pi \varepsilon_0 m_b v_0^{' 2}} \right)^2 \cdot \frac{1}{\sin^4 \left( \frac{\theta_b^{'}}{2} \right)} 
\end{align}
where $d\Omega$ is the solid angle, $Z_b$ and $Z_t$ is the proton number of the beam and target nuclei respectively, $e$ is the elementary charge, $\varepsilon_0$ is the electric permittivity in vacuum, $m_b$ is the mass of the beam particle, $v_i^{'}$ is the initial velocity of the beam particle in the CM frame and $\theta_b^{'}$ is the beam particle scattering angle in the CM frame \cite{Klintefjord, Krane, EE-Coulex}.

Under the condition, $\xi \ll 1$, the differential cross section, $d\sigma_{i \rightarrow f}$, for inelastic scattering of point-like objects from the initial state $|i\rangle$ to the final state $|f\rangle$ is given by 
\begin{align}
	\frac{d\sigma_{i \rightarrow f}}{d\Omega} 
	&= \frac{d\sigma_R}{d\Omega} \cdot P_{i \rightarrow f} 
\end{align}
The excitation probability, $P_{i \rightarrow f}$, is given by
\begin{equation}
	P_{i \rightarrow f} = \frac{1}{2I_i + 1} \sum_{M_i, M_f} | a_{if} |^2
\end{equation}
where $I_i$ is the \textcolor{red}{??? spin / angular momentum ???} of the state $|i\rangle$, $M_i$ and $M_f$ is the angular momentum projections of initial and final states, respectively \cite{EE-Coulex, NaR}.
$a_{if}$ is the excitation amplitudes summed over all magnetic substates, which can be expressed by
\begin{equation}
	a_{if} = \frac{1}{i\hbar} \int_{-\infty}^{\infty} e^{i \frac{\Delta E}{\hbar} t} \langle f | H(t) | i \rangle ~dt
\end{equation}
where $\Delta E = E_f - E_i$ is the energy difference of the final and initial state, respectively, $H(t)$ is the time-dependent electromagnetic interaction between the beam and the target \cite{Klintefjord, Niedermaier, NaR}.

The total electric excitation cross section from a state $|i\rangle$ to a state $|f\rangle$ is given by
\begin{equation}\label{tot_sig_E}
	\sigma_E = \sum_\lambda \sigma_{E \lambda}
\end{equation}
with
\begin{equation}\label{sig_E}
	\sigma_{E \lambda} = \left( \frac{Z_b e}{\hbar v_i} \right)^2 a^{-2 \lambda + 2} B(E \lambda; I_i \rightarrow I_f) f_{E \lambda} (\xi)
\end{equation}
The reduced transition probability, $B(E \lambda)$, is related to the matrix elements of the electric multipole order by
\begin{equation}
	B(E \lambda; I_i \rightarrow I_f) = \frac{1}{2I_i + 1} | \langle f | \mathcal{M}(E \lambda)| i \rangle |^2 
\end{equation}
and the Coulomb excitation function, $f_{E \lambda} (\xi)$ is given by
\begin{equation}
	f_{E \lambda} (\xi) = \int_\Omega df_{E \lambda} (\theta_b^{'}, \xi)
\end{equation}
where the integration is performed over all scattering angles of the solid angle $\Omega$ in the CM frame \cite{Niedermaier, EE-Coulex}.
The Coulomb excitation function is dependent on $\xi$ and the multipolarity. 
In a special case with $E2$ transitions and $\xi \ll 1$, the function is $f_{E \lambda} (\xi) \approx 1$.
From the reduced transition probabilities with $\lambda = 2$, it is possible to show that \autoref{sig_E} becomes \cite{NaR}
\begin{equation}
	\sigma_{E2} \approx \left( \frac{Z_b e}{\hbar v_i} \right)^2 a^{-2} = \left( \frac{mv_i}{Z_t e\hbar} \right)^2
\end{equation}

There is a relation of the reduced transition probability between the excitation $B(E2 \uparrow)$ and the decay $B(E2 \downarrow)$ of a state, which is given by 
\begin{equation}
	B(E2; I_f \rightarrow I_i) = \frac{2I_i + 1}{2I_f + 1} B(E2; I_i \rightarrow I_f)
\end{equation}

For an $E2$ transition from the ground state $0_1^+$ and the first excited state $2_1^+$, we have the relation
\begin{align}
	B(E2; 0_1^+ \rightarrow 2_1^+) = 5 \cdot B(E2; 2_1^+ \rightarrow 0_1^+)
\end{align} 
This means that the excitation probability has five times more final substates to go to, compared to the decay probability.

Similarly to the total electric cross section, the total magnetic cross section can be expressed as \cite{EE-Coulex}
\begin{equation}
	\sigma_M = \sum_\lambda \sigma_{M \lambda} = \left( \frac{Z_b e}{\hbar c} \right)^2 \sum_\lambda a^{-2 \lambda + 2} B(M \lambda; I_i \rightarrow I_f) f_{M \lambda} (\xi)
\end{equation}
The equations are very similar, but notice the $1/c$ in the first fraction, in addition to the switching of $E$ to $M$.


\subsection{Safe COULEX}
In order to ensure that the interaction is purely electromagnetic in nature, and not nuclear, a safe energy is chosen for the reaction. 
The energy is supposed to be below the Coulomb barrier.
Safe COULEX is when the distance of closest approach between the particles is large enough to exclude nuclear interaction.
The safety distance, $d_{safe}$, in safe COULEX is chosen by the condition
\begin{align}
	d_{safe} \geq d_{min} &= d_C + d_s \nonumber \\
	&= R_b + R_t + d_s \nonumber \\
	&= r_0 (A_b^{1/3} + A_t^{1/3}) + d_s \nonumber \\
	&= 1.25 (A_b^{1/3} + A_t^{1/3}) + 5~\text{[fm]}
\end{align}
where $d_{min}$ is a way to approximate the distance of closest approach by the Coulomb interaction distance, $d_C$, and an additional safety distance, $d_s = 5$ fm.
$R_b$ and $R_t$ is the radii of the beam and target nuclei, respectively, and $A_b$ and $A_t$ is the mass number of the beam and target nuclei, respectively \cite{RBass, Cline1986}.

The maximum beam energy in the LAB frame, $E_{b, max}$, is chosen from the special case when $\theta_b^{'} = 180^\circ$ \cite{Klintefjord, RBass}
\begin{align}
	E_{b, max} (\theta_b^{'})
	&= \frac{Z_b Z_t e^2}{A_r d_{min}} \cdot \frac{2}{1 + \csc \left( \frac{\theta_b^{'}}{2} \right)} \\
	&\approx \frac{Z_b Z_t}{A_r} \cdot \frac{1.44}{1.25 (A_b^{1/3} + A_t^{1/3}) + 5} ~\left[ \tfrac{\text{MeV}}{\text{u}} \right]
\end{align}

\textcolor{red}{Dette blir 4.63 MeV/u for Sm på Pb. Hvordan ble 4.7 MeV/u regnet ut?}



For the reaction, only the energy, $E^{'}$, and relative momentum in the CM frame is available, while the remainder is recoil energy, $E_t$, of the total system
\begin{equation}
	E_t = \frac{A_b}{A_b + A_t} E_b
\end{equation}
In the CM frame, the kinetic energy is given by
\begin{equation}
	E^{'} = E_b - E_t = \frac{A_t}{A_b + A_t} E_{b}
\end{equation}
where $A_b$ and $A_t$ is the mass number of the beam and target nuclei and $E_{b}$ is the kinetic energy of the beam particle in the LAB frame \cite{Niedermaier, NaR}.


\subsubsection*{\textcolor{red}{Må man referere til alle ligninger som har nummer, eller kan de stå med nummer uten å referere til?}}



\subsection{Electric quadrupole moments}

The electric quadrupole moment is a parameter that describes the charge distribution of a nucleus and thus its shape.
In the classical definition it is given by
\begin{align}
	Q_{ij} = \int \rho(\mathbf{r}) (3r_i r_j - r^2 \delta_{ij}) ~d^3 \mathbf{r}
\end{align}
where $\rho$ is the charge density distribution, $\mathbf{r} = (x, y, z)$ are the Cartesian coordinates. 
\textcolor{red}{Hva er $r_i$ og $r_j$?}
and
\begin{align}
	\delta_{ij} =
    \begin{cases}
    		0, & \text{if } i \neq j \\
    		1, & \text{if } i = j
    \end{cases}
\end{align}
is the Kronecker delta.
It is possible to rotate the frame such that the $z$-axis coincides with the symmetry axis. 
With axial symmetry \cite{Niedermaier, ELP}, we choose the $z$-axis along the symmetry axis and gets
\begin{align}
	Q_z &= \int \rho(\mathbf{r}) (3z^2 - r^2) ~d \mathbf{r} \nonumber \\
	&=  \int \rho(\mathbf{r}) (3\cos^2 \theta - 1) ~d \mathbf{r} \nonumber \\
	&=  \sqrt{\frac{16\pi}{5}} \int \rho(\mathbf{r}) r^2 Y_{20}(\theta, \phi) ~d \mathbf{r} \nonumber \\
	&= Q_{20}
\end{align}
In this case, the charge distribution is fully characterized by $Q_z$, because symmetry gives $Q_x = Q_y$. 
$Q_z = 0$ corresponds to a spherical shape, while $Q_z > 0$ corresponds to a prolate shape and $Q_z < 0$ corresponds to a oblate shape.
In the same way as $Q_{20}$, it is possible to define 
\begin{align}
	Q_{22} &= \sqrt{\frac{16\pi}{5}} \int \rho(\mathbf{r}) r^2 Y_{22}(\theta, \phi) ~d \mathbf{r}
\end{align}
All quadrupole shapes can be described by $Q_{20}$ and $Q_{22}$.

For a state with spin $I$ we can observe the spectroscopic quadrupole moment
\begin{align}
	Q_s(I) &= \langle I, m = I | \hat{Q}_{20} | I, m = I \rangle \\
	&= \sqrt{\frac{I(2I - 1)}{(2I + 1)(2I + 3)(I + 1)}} \langle I | \hat{Q}_2 | I \rangle
\end{align}
where $\hat{Q}_2$ is the electric multipole operator \cite{RS} from
\begin{align}
	\hat{Q}_{\lambda \mu} = \int \rho(\mathbf{r}) r^\lambda Y_{\lambda \mu}(\theta, \phi) ~d^3 \mathbf{r}
\end{align}
\textcolor{red}{Må sikkert forklare flere parametre over her...}
The spectroscopic quadrupole moment is what we can observe in the LAB frame.
Here we see that $I = 0$ or $\tfrac{1}{2}$ gives $Q_s = 0$, which means that a nucleus with these spins can have intrinsic deformation, but it cannot be measured via the spectroscopic quadrupole moment \cite{ELP}.  

The intrinsic quadrupole moment, $Q_0$, is in the body-fixed frame.
It is related to the spectroscopic quadrupole moment via
\begin{align}
	Q_s = \frac{3K^2 - I(I+1)}{(I+1)(2I+3)} Q_0
\end{align}
where $K$ is the projection of total angular momentum onto the body-fixed symmetry axis.
$K$ is only defined if there is a symmetry axis, that is if the nucleus has rotational symmetry.
If the total angular momentum is perpendicular to the symmetry axis, then $K = 0$.
The intrinsic quadrupole moment, $Q_0$, reflects the nuclear deformation, $\beta$, and is related via \cite{Klintefjord}
\begin{align}
	Q_0 &= \int \rho(\mathbf{r}) (3z^2 - r^2) ~d \mathbf{r} \nonumber \\
	&= \frac{3}{\sqrt{5\pi}} Ze R^2 \beta &&\cite{RS} \\
	&= \frac{3}{\sqrt{5\pi}} Z R^2 (\beta + \textcolor{blue}{0.16}\beta^2) &&\cite{Klintefjord} \\
	&= \frac{3}{\sqrt{5\pi}} Z R^2 (\beta + \textcolor{purple}{0.36}\beta^2) &&\cite{ELP}
\end{align}
\textcolor{red}{??? Hva er riktig ???}\newline
If the intrinsic shape is prolate, $Q_0 > 0$, the measurements shows an oblate shape in the laboratory frame, $Q_s < 0$.
A prolate deformed nucleus that is rotating rapidly about the perpendicular axis appears to be oblate.
Obtaining information on $Q_s$ and the relative signs of matrix elements can help us to directly distinguish between prolate and oblate shape.


\subsection{Transition probabilities}


Lect. 09.06.18: \newline
Classical electrodynamics: charge in charge or current distribution $\rightarrow$ EM radiation.\newline
Oscillating el. charge (dipole) $\rightarrow$ el. dipoile radiation \newline
Oscillating current in a loop $\rightarrow$ magnetic dipole radiation \newline
general: EM multipole radiation, multipolarity $\sigma \lambda$, $\sigma \in \{ E, M \}$ \newline
a gamma quant of multipolarity $\lambda$ carries angular momentum $\lambda \hbar$ with $z$ component $\mu \hbar$

Angular momentum conservation
\begin{align}
 	| I_i - I_f | \leq \lambda \leq I_i + I_f 
\end{align}
$\mu = m_b - m_t$

if observe: $I_i = 2, I_f = 3$, dipole multipolarity most likely. 

Transition with lowest multipolarity are most likely ($\lambda$ small).


\subsection{\textcolor{red}{gamma}}

\textcolor{blue}{"The parity radiation field is"} \cite{Krane}

\begin{align}
	\pi (\sigma \lambda) =
    \begin{cases}
    		(-1)^\lambda, & \text{for } \sigma \lambda = E\lambda \\
    		(-1)^{\lambda + 1}, & \text{for } \sigma \lambda = M\lambda
    \end{cases}
\end{align}

\textcolor{blue}{"The $E\lambda$ transition probability is estimated to be"} \cite{Krane}
\begin{align}
	T(E\lambda) \approx \frac{8\pi (\lambda + 1)}{\lambda [(2\lambda + 1)!!]^2} \frac{e^2}{4\pi \varepsilon_0 \hbar c} \left( \frac{E_\gamma}{\hbar c} \right)^{2\lambda + 1} \left( \frac{3}{\lambda + 3} \right)^2 c R^{2\lambda}
\end{align}

\textcolor{blue}{"The result for the $M\lambda$ transition probability is"} \cite{Krane}
\begin{align}
	T(M\lambda) \approx & \frac{8\pi (\lambda + 1)}{\lambda [(2\lambda + 1)!!]^2} \frac{e^2}{4\pi \varepsilon_0 \hbar c} \left( \frac{E_\gamma}{\hbar c} \right)^{2\lambda + 1} \left( \frac{3}{\lambda + 3} \right)^2 c R^{2\lambda - 2} \nonumber \\
 & \cdot \left( \mu_p - \frac{1}{\lambda + 1} \right)^2 \left( \frac{\hbar}{m_p c} \right)^2
\end{align}


Transition rates of high multipolarity are relatively unlikely.

Transition probabilities
\begin{align}
	T_{i \rightarrow f} (\sigma \lambda \mu) = \frac{8\pi (\lambda + 1)}{\lambda \hbar [(2\lambda + 1)!!]^2} \left( \frac{E_\gamma}{\hbar c} \right)^{2\lambda + 1} B(\sigma \lambda; I_i \rightarrow I_f)
\end{align}
where $\hat{O}_{\lambda \mu} \in \{ \hat{E}_{\lambda \mu}, \hat{M}_{\lambda \mu} \}$ is the electric or magnetic multipole operator.

\begin{align}
	B(\sigma \lambda; I_i \rightarrow I_f) &= \sum_{M_i, M_f} | \langle I_f M_f | \hat{O}_{\lambda \mu} | I_i M_i \rangle |^2  \nonumber \\
	&= \frac{1}{2I_i + 1} | \langle I_f | \hat{O}_{\lambda \mu} | I_i \rangle |^2
\end{align}
is the reduced transition probability.

\begin{align}
	| \langle I_f | \hat{O}_{\lambda \mu} | I_i \rangle |^2 &= | \langle I_i | \hat{O}_{\lambda \mu} | I_f \rangle |^2 &  B(\sigma \lambda; I_f \rightarrow I_i) &\neq B(\sigma \lambda; I_i \rightarrow I_f)
\end{align}
The reduced transition probabilities are not the same if the spin states are interchanged. 


\autoref{tab:gamma_sel} shows the \ga\ selection rules.

\begin{table}[htb] 
    \centering 
    \caption{\ga\ selection rules. Electric transitions are more likely than magnetic transitions of the same multipole $\lambda$. There are no \ga\ transitions with $\lambda = 0$, that is no $I_i = 0 \rightarrow I_f = 0$. The $0 \rightarrow 0$ transitions proceed via internal conversion or internal pair creation.}
	\input{Table-data/Gamma.tex}
	\label{tab:gamma_sel}
\end{table}


\begin{figure}[htb]
	\centering
	\includegraphics[width=0.6\textwidth]{Images/transitions.png}
	\caption{(a) Excitation probability. (b) Decay probability.}
	\label{fig:transitions}
\end{figure}


% ----------------------------------------------------------------------------------------------------------------------
% ----------------------------------------------------------------------------------------------------------------------

\chapter{Coulomb excitation experiment}
\epigraph{\textit{"If I could remember the names of all those particles, I'd be a botanist."}}{\textit{– Enrico Fermi}}

\section{ISOLDE at CERN}
ISOLDE is a Radioactive Ion Beam (RIB) facility at CERN in Meyrin, Switzerland. \autoref{fig:accelerators} shows the CERN accelerator complex, where ISOLDE is located beside the Proton Synchrotron Booster (PSB), in the lower right marked by a green box. The acronym ISOLDE stands for Isotope Separator On Line DEvice. The facility can produce over 1000 different radionuclides to be used in a wide variety of experiments in nuclear physics, atomic physics, solid state physics, life sciences and fundamental interactions. Experiments have been performed at ISOLDE since 1967 and since 2001 experiments with post-accelerated RIBs have been conducted  \cite{HIE-ISOLDE, ISOLDE-web, ISOLDE-facility}. 
The High Intensity and Energy upgrade (HIE-ISOLDE) made it possible to deliver beam energies up to 7.5 MeV/u in July 2017 \cite{CERN-news}. 
The present experiment was one of the first Miniball experiments with the upgraded superconducting LINear ACcelerator (LINAC), the HIE-ISOLDE LINAC. 
Further upgrades, after the present experiment, have made it possible to deliver beam energies up to 10 MeV/$u$ in 2018 \cite{HIE-ISOLDE}. 

\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth]{Images/CERN-accelerators.png}
	\caption{The CERN accelerator complex, adapted from \cite{CERN-AC}. ISOLDE, marked with a green box, receives accelerated protons from LINAC 2 and the PS Booster.}
	\label{fig:accelerators}
\end{figure}

In general, it is very challenging to study radioactive, short lived nuclei. 
The newest edition of the Karlsruhe Nuclide Chart have nuclear data of over 4000 nuclides, and most of these are radioactive \cite{CoN}. 
In many cases it is not possible produce a target of a radioactive nuclei and to perform experiments due to the short half-life of the involved nucleus. 
To study these radioactive nuclei, RIBs are accelerated at stable targets. 

The beam at the RIB facilities consists of, as the name implies, radioactive isotopes. 
In contrast to conventional facilities where the target is made out of the isotope of interest, the investigated isotope is the beam accelerated into a target.
The velocity of the beam is significant, with $v/c$ values of a few percent. 

One way of obtaining a RIB is to use the Isotope Separator On Line (ISOL) method. 
There are three main reactions for producing radioactive atoms with the ISOL method; spallation, fragmentation and fission. 
Nuclear spallation is the process in which light fragments of the target are ejected due to the high-energy impact of the incoming beam. 
Fragmentation is the splitting of a target compound into smaller particles or unstable ions. 
In fission, a nucleus is split into two or more nuclei.
When applying the ISOL method, two accelerator systems are required. 
The first accelerator is used to produce the radioactive atoms by spallation, fragmentation or fission of the primary target nuclei. 
Then, the second accelerator is used to accelerate the RIB atoms into a secondary target \cite{ISOLDE-web, Lindroos, ISOL}. 

In RIB facilities, the intensity is generally a bit lower compared to stable beam facilities, which is a big challenge. 
In terms of energy, ISOL facilities operate around the Coulomb barrier, making them suitable for Coulomb excitation and particle transfer reactions. 

In the electromagnetic (EM) interaction with the target, the beam gets excited into a higher energy state.
When the beam isotopes de-excite, they emit \ga-rays, which can be observed to have large Doppler shifts depending on the velocity and angle.
Due to the finite solid angle of the detectors, a sizable Doppler broadening can be observed in the \ga-rays. 
When the detection system has high granularity, that is, that the system consists of many segmented detectors, the Doppler shifts and broadening can be corrected for. 
If the angle between the recoiling nucleus and the \ga-ray can be determined accurately, a Doppler correction can be applied \cite{MB-spect}, as described in \textcolor{red}{Section ??? [theory / data analysis]}.


\section{Experimental setup}

\textcolor{Magenta}{Tilbakemelding:\newline
Detaljer om eksperimentet. 1. Når. 2. Hvor lenge varte det. 3. Forskningsgrupper som samarbeider om eksp. 4. Nevne / minne leser på hva som er målet med eksp. og grovt hvordan det gjøres.
} 
\textcolor{red}{Dette tenkte jeg å ha i innledningen..}
\textcolor{Magenta}{Tilbakemelding 2:\newline
Det kan fort bli for detaljert for innledningskapittelet, jeg tenker innledningen er litt mer svevende uten alt for mange spesifikke detaljer. Dette kap heter jo eksp setup og skal fråtse i detaljer. MEN det er lov til å gjenta seg selv, det er lenge siden innledningen, så ikke farlig om litt blir gjentatt (leseren kan ha glemt hva du sa i innledningen innen de leser her). 
} 

\subsection{Beam production}
\autoref{fig:Coulex} shows a sketch of the experimental setup of the \Sm\ Coulomb excitation experiment. 
Accelerated proton beam bunches from the PSB comes into the ISOLDE facility and collide with a thick production target, the primary target. 
Two proton beam bunches are separated by 1.2 s.
The proton beam has an energy of 1.4 GeV and an intensity up to 2 $\mu$A \cite{TIF, TIF2013}. 
ISOLDE typically takes 50\% \cite{MB-spect} of all proton bunches form the PSB, the rest goes to the Large Hadron Collider (LHC) and the other experiments shown in \autoref{fig:accelerators}. 

\begin{figure}[ht]
	\centering
	\input{Images/Coulex-setup.tikz}
	\caption{The Coulomb excitation setup at ISOLDE for the present experiment. Adapted from \cite{Klintefjord}. See text for information.}
	\label{fig:Coulex}
\end{figure}

The production target material is chosen depending on the RIB of interest. 
If the requested RIB is neutron-rich, a primary target of uranium ($^{238}$U) is chosen, and the beam will be produced by fission of the target nuclei.
In this experiment, a neutron-deficient RIB was requested, and a primary target of tantalum (Ta, $Z = 73$) was chosen.
The production target is selected from a region in the chart of nuclides containing stable nuclei that are heavier than the nucleus of interest.
When the proton beam collides with the primary target, the target is smashed into pieces, and radioactive isotopes with proton number up to Ta are produced.
In this way, a large range of isotopes are produced. 

The remaining challenge is to extract the isotope of interest in order to create a RIB. 
Before the desired isotope can be obtained, a method of selecting the chemical element of interest have to be used.
One approach is to use a method of selective ionization and then a high voltage electrostatic field to extract the ions. 
Electronic transitions are characteristic for each chemical element. 
A laser with a precisely tuned wavelength can obtain the photon energy that matches the electronic transition energies in the atom perfectly \cite{RILIS-web, RILIS2013}. 
Thus we can use one laser to excite an electron to a specific excited electron-state in the atom, a second laser to excite electrons further to another excited electron-sate and a third laser to remove the electron entirely. 
In this way, we only ionize the element required to produce the beam. 

The Resonance Ionization Laser Ion Source (RILIS) is based on the method of step-wise (2-3 step) excitation and ionization of an atom. 
It is an element-selective process which is used to produce ion beams of the desired element \cite{RILIS}. 
In this experiment, RILIS was used to select samarium (Sm) with atomic number $Z = 62$. 
After RILIS has selected Sm, we have a continuous beam of Sm$^{+1}$ ions at an energy of 60 keV. 
\textcolor{blue}{The primary target is on a 60 kV high voltage platform} \textcolor{red}{??? fjerne eller utdype ???} \cite{ISOLDE-web, TIF}. 

After the ionization of the beam, the next step in the process is to perform a mass separation.
The goal of the mass separation is to obtain a beam only containing the isotopes with the desired mass number, and to exclude the contaminants that exits RILIS. 
By using a set of magnets, the separator purifies the RIB, but in principle, isobaric contaminants may still be present in the beam after the separation. 
Luckily, the neighboring elements of Sm produces very little surface ionization. 
Therefore, few contaminants are expected to be present in the beam after the separator. 
Different sources of beam contaminants are discussed in \autoref{ssec:bcontaminants}.

At ISOLDE, the beam may hit one of two target stations after RILIS; either the General Purpose Separator (GPS) or the High Resolution Separator (HRS). 
Both separators feed the beam lines in the experimental hall, but only one separator is active during an experiment. 
The HRS combine two bending magnets with high mass resolving power, delivering the beam into the main beam line. 
Even though the HRS have a high mass resolving power, $M/\Delta M > 5000$, it is not sufficient resolving power to separate the isobars, which is why RILIS and the GPS was used in the current experiment.
The GPS has one bending magnet and can deliver beams containing isotopes of different mass numbers simultaneously into three beam lines. 
The two extra beam lines that the GPS can feed, can have an isotope mass difference of $\pm 13 \%$ compared to the main beam line isotope mass \cite{GPS, TIF}.
In this experiment the GPS was used to select the isotope of Sm with mass number $A = 140$. 

Following the GPS, a continuous beam of \Sm\ is obtained. 
The post-accelerator cannot accept an incoming continuous beam, it can only accelerate bunches.
In the Radioactive beam EXperiment TRAP (REXTRAP), the \Sm\ ions are collected in order to release them in bunches that are matched to the time structure of the HIE-ISOLDE LINAC. 
REXTRAP is a penning trap which tasks are accumulation, bunching and cooling of the RIB \cite{HIE-ISOLDE, REXTRAP1, REXTRAP2}. 
The ions are released in bunches and transfered to the REX Electron Beam Ion Source (REXEBIS), see \autoref{fig:Coulex}.

REXEBIS is a charge breeder where the RIB obtains a high charge state \cite{REXEBIS}, with a mass-to-charge ($A/q$) ratio typically between 2.5 and 4.5 \cite{Post-acc}.
In REXEBIS, even more electrons of the RIB atoms are removed through the interaction with a high-intensity electron beam. 
The longer the ions stay in REXEBIS, the higher the charge state becomes. 
The EBIS blasts off more electrons from Sm, which leaves the nucleus in a high charge state, going from \Sm$^{+1}$ to \Sm$^{+34}$ with $A/q \approx 4.1$. 

To accelerate the charged ions, that is the beam, to high energy, the beam must consist of highly charged ions. 
Inside REXEBIS a distribution of charge states are obtained, but the HIE-ISOLDE LINAC can only accept one charge state.
Therefore, only the parts of the RIB containing the correct charge state is accelerated, the remainder of the beam is lost \cite{REX-web, HIE-web, EBIS2002, EBIS2010}.
REXEBIS releases the beam with a specific energy through another mass separator before guiding the RIB into the HIE-ISOLDE LINAC. 
The purpose of the second mass separator is to remove residual gas (beam contaminants) from the beam exiting REXEBIS \cite{HIE-ISOLDE}. 

The HIE-ISOLDE LINAC accelerates the beam of \Sm\ with excellent purity to 4.65 MeV/u, or a total energy of 651 MeV, through the beam line. 
Several magnets bend the beam into the Miniball spectrometer, where the beam hits the secondary target of \Pb. 
The beam particles get excited due to the electromagnetic interaction with the target.
%There is a very small probability of exciting the target, explained in \autoref{ssec:Pb}.
As the \Sm\ particles from the beam fly towards the particle detector, they de-excite by emitting \ga-rays, which are then detected by the \ga\ detectors.
The detector system records information about the angles and energy with a good time resolution. 
In this way, particle-\ga\ coincidences can be reconstructed to obtain Doppler-corrected \ga-spectra  in order to analyze the Coulomb excitation of \Sm.


\subsection{Sources of beam contaminants}\label{ssec:bcontaminants}
To have a successful experiment, the purity of the beam is of great importance. Contaminants in the beam can come from several different sources. 
A common experimental challenge are contaminants from surface ionization, that is, atoms that collide with the walls of the ion source. 
This can be significant, even dominant in some cases. 
However, surface ionization was not an issue in the present experiment due to the fact that Sm has the lowest ionization potential of the rare earth elements. 
In any case, the beam contaminants are monitored by periodically switching the laser on and off.
Arising from the primary target we may have \cite{MB-spect}:
\begin{itemize}
	\item isobaric contaminants which are inseparable by the mass separator because of the same mass number
	\item isotopes with an integer multiple of both mass and charge
\end{itemize}
and from stable isotopes the contaminants can come from:
\begin{itemize}
	\item buffer gas in REXTRAP (e.g. Ne, Ar)
	\item residual gas in REXEBIS (e.g. C, O)
	\item components of REXEBIS (e.g. La from the cathode)
\end{itemize}
More information on contaminants can be found in \cite{HIE-ISOLDE, RILIS, MB-spect}.

%\textcolor{Magenta}{Tilbakemelding: \newline
%Blir litt lange setninger for en liste øverst. Skriv om til tekst eller del opp i flere setninger. \newline
%"with an integer multiple of both mass an charge" er litt uforklarlig? \newline
%}

\subsection{The secondary target}\label{ssec:Pb}
For the current experiment, a target consisting of \Pb\ with a thickness of 1.4 mg/cm$^2$ was chosen. 
Unfortunately, there was a finger print on the target, implying a contamination (probably carbon and/or oxygen from grease).

It is quite difficult to excite $^{208}_{~82}$Pb$_{126}$ as it is a doubly magic nuclei, and it is therefore well suited for the experiment. 
In that way, transitions from the target will not complicate the \ga-ray spectrum.
With a target consisting of the highest possible $Z$ of a stable isotope ($Z = 82$), the excitation probability of \Sm\ is maximized. 

\Pb\ has no quadrupole deformation.
The first excited state is an octupole vibration with an energy of 2615 keV, a half-life of $T_{1/2} = 16.7$ ps and a spin and parity of $J^\pi = 3^-$.
Therefore, there is a small probability of observing the first excited state of \Pb\ in the \ga-spectrum. 
The excitation probability for \Pb\ is maximal if the EM interaction is approximately head on, and the ejected target nucleus hits one of the inner particle detector rings.


\subsection{Miniball spectrometer}
\autoref{fig:MBSpect} shows an overview picture of the Miniball spectrometer. 

\textcolor{Magenta}{Tilbakemelding:\newline
Legg til en intro setning, overfladisk beskriv hvordan Miniball ser ut og i grove trekk hvilke deler den består av.
}
\textcolor{red}{Skal jeg ha bilder av Miniball spektrometeret, eller skal jeg fjerne dem? Det er jo ikke akkurat som man ser så veldig masse.. evt. flytte til appendix? (skal i alle fall beholde target wheel)}

\begin{figure}[ht]
	\centering
	\includegraphics[width=\linewidth]{Images/IMG3849.JPG}
	\caption{An overview picture of the Miniball spectrometer. The target chamber is in the middle of the picture, surrounded by the \ga\ detector array. Photo by: Trond Wiggo Johansen.}
	\label{fig:MBSpect}
\end{figure}


\subsubsection{Target chamber}
The target chamber is a hollow sphere made out of a machined out, single piece of aluminium alloy (AlMg$_3$), with a thin wall and an inner radius of approximately 80 mm. 
Inside the chamber we find a target wheel and a particle detector. 
As shown in \autoref{fig:TWheel}, the target wheel can hold up to six different targets. 
The particle detector can be positioned 25 - 31 mm from the target wheel, limited by the space inside the chamber. 
Outside of the target chamber, the average distance from each \ga\ detector cluster to the center of the target chamber is approximately 10 cm.
The forward and the backward \ga\ detector clusters are placed in a 45$^\circ$ and 135$^\circ$ angle $\theta$, respectively, compared to the beam line.
In the vertical plane, perpendicular to the beam line, the four \ga\ detector clusters in forward and backward position are placed roughly on a circle with a separation of $\phi = 90^\circ$ \cite{MB-spect}.  

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\linewidth]{Images/Target-wheel.png}
	\caption{The target wheel can hold up to six different targets. Position 1 and 2 are holes with a diameter of 3 and 12 mm respectively. They are used for beam tuning. Position 3 and 4 has \Pb\ targets with thickness 2.5 and 0.7 mg/cm$^2$ respectively. Position 5 has 13 layers of $^{27}$Al foil. Position 6 has the target \Pb\ with thickness 1.4 mg/cm$^2$, which was the secondary target used in the present experiment. Photo by: Dr. Liam Gaffney, date: 07.08.2017.}
	\label{fig:TWheel}
\end{figure}


\subsubsection{Particle detector, DSSSD (CD)}
To detect the scattered beam and target nuclei, a segmented Double Sided Silicon Strip Detector (DSSSD) composed of four quadrants was used. 
\autoref{fig:CD-FB} shows a sketch of the front and back of the detector. 
The DSSSD resembles an audio Compact Disc (CD), and hence it is called the CD. 
In the front of the CD, one quadrant consists of 16 annular strips (rings) with a pitch of 2 mm, while the back consists of 24 sector (radial) strips with a pitch of 3.5$^\circ$. 
The innermost strip has an inner radius of the active area of 9 mm, while the outermost strip has an outer radius of the active area of 40.9 mm. 
The active area of the detector is the area in which a particle can be detected, the detectable surface. 

In total, there are 160 discrete detector elements for all four quadrants, 64 in front and 96 in back. 
Each quadrant of the CD is independently connected to a Analog to Digital Converter (ADC) and a Time to Digital Converter (TDC). 
The TDC keeps track of the time of registered particle-\ga\ and particle-\ga-\ga\ coincidences. 
As a result of too few available channels in the ADC, the sector strips in the back are paired up.
In consequence, it is effectively 12 strips on the back side of the CD. 

The whole CD detector has a total area of 5000 mm$^2$, where approximately 93$\%$ of the detector consists of a detectable surface. 
In Coulomb excitation experiments the silicon wafer thickness is usually 500 $\mu$m.
The silicon wafer is the thin slice of semiconductor which can detect the incoming particles. 
For simplicity the dead layer thickness is usually assumed to be 0.7 $\mu$m \cite{NWarr-CD, MB-spect}. 
\autoref{tab:CD_spec} shows some of the specifications of the CD.  
The distance from the target to the CD was 27 $\pm$ 1 mm. 
In the laboratory (LAB) reference frame the CD has a angular coverage between 18.4$^\circ$ and 56.6$^\circ$. An extensive description of the CD can be found in \cite{CD-DSSSD}.

%\footnote{The distance was measured using a $\alpha$-source ($^{226}$Ra). The source has a thickness of 1.23 mm, which has to be accounted for. The target to CD distance is therefore the CD to source distance plus the source thickness, that is 25.78(12) mm + 1.23 mm = 27.01 mm. This source data was reanalyzed, giving a 0.03 mm discrepancy form the original log entry. In private communications at ISOLDE in August 2018, the distance from the target to the CD was determined to be 26.98 mm with a $\sim$1 mm uncertainty.}

\begin{figure}[ht]
	\centering
	\includegraphics[width=\linewidth]{Images/CD.png}
	\caption{CD sketch, adapted from \cite{NWarr-CD}. 
	On the left is the front side of the CD. 
	The beam goes into the paper from the perspective of the left drawing.
	Front (annular) strips are numbered from 0 (outermost) to 15 (innermost). 
	Quadrants are numbered in clockwise direction with respect to the beam direction, which corresponds to: left is 1, up is 2, right is 3 and down is 4.
	On the right is the back side of the CD. 
	The beam comes out of the paper from the perspective of the right drawing.
	Back (radial) strips are numbered from 0 to 23 in counter-clockwise direction.
	Viewed from this perspective, the quadrants are numbered as: right is 1, up is 2, left is 3 and down is 4.}
	\label{fig:CD-FB}
\end{figure}


\begin{table}[ht] 
    \centering 
    \caption{CD specifications.}
	\input{Table-data/CD-spec.tex}
	\label{tab:CD_spec}
\end{table}


\subsubsection{The high-purity germanium (HPGe) \texorpdfstring{$\gamma$}{Gamma} detectors}
In Coulomb excitation experiments, the target chamber is surrounded by the \ga\ detectors as displayed in \autoref{fig:MBSpectCU}. 
The \ga-ray spectrometer consists of a total of 24 six-fold segmented High-Purity Germanium (HPGe) crystals, which are divided into 8 clusters of 3 crystals each. 
Each crystal is encapsulated and segmented into 6 parts, making a total of 144 segments. 
Compared to using the whole crystal, a better Doppler correction can be performed when the \ga\ detectors are segmented. 

\begin{figure}[ht]
	\centering
	\includegraphics[width=\linewidth]{Images/IMG3917.JPG}
	\caption{Close up picture of the Miniball spectrometer. The Miniball target chamber is in the middle, surrounded by the triple-cluster encapsulated \ga\ crystals. The beam line goes through the target chamber. \\ Photo by: Trond Wiggo Johansen.}
	\label{fig:MBSpectCU}
\end{figure}

For maximum efficiency, the detectors are placed in a compact geometry around the target chamber \cite{NWarr-HPGe, MB-spect}. 
The detector-array can cover a solid angle of about 60\% of 4$\pi$, when the optimum distance between the target chamber and the HPGe clusters is achieved. 
The average energy resolution at $E_\gamma = 1.3$ MeV is 2.3 keV \cite{Butler2017}. 
During operation the HPGe clusters needs to be cooled down by liquid nitrogen which is provided by the automated filling system. 

\autoref{fig:HPGe} shows a sketch of one triple-cluster of the HPGe \ga\ detector array, with the corresponding table of all of the clusters positions.
From each detector we get seven signals in total for each event, one from the core and six from each segment. 
This requires 168 channels for data acquisition. 
The shapes of these signals are analyzed to provide information about the energy and time of the \ga-ray, in addition to the detection position within the detector cluster \cite{NWarr-HPGe}.

\begin{figure}[ht]
	\centering
	\begin{subfigure}[b]{0.49\textwidth}
		\centering
		\includegraphics[width=\textwidth]{Images/HPGe2.png}
	\end{subfigure}
	\hfill
	\begin{subfigure}[b]{0.49\textwidth}
		\centering
    		\input{Table-data/Geometry.tex} \newline % newline lifts the table up one line
	\end{subfigure}
	\caption{On the left is a sketch of the HPGe triple-cluster position, adapted from \cite{Rosiak}. 
	Each cluster is segmented into 6 parts. 
	The core signal is marked by the blue dots in the middle of each of the three crystals, and the center of the triple-cluster is marked with a red dot. 
	There are four parameters, $\theta_i$, $\phi_i$, $\alpha_i$ and $R_i$, to determine the position of one triple-cluster.
	The angles, $\theta_i$ and $\phi_i$, are defined from a right-hand polar coordinate system, as displayed by the sketch.
	$\alpha_i$ determines the clockwise rotation around the center of the triple-cluster as seen from the target position.
	$R_i$ is the distance from the middle of the target chamber to the center of one triple-cluster.
	In the sketch, the secondary target is positioned in origo and the beam direction goes along the $z$-axis \cite{NWarr-Angles, Rosiak}. 
	On the right side is a table which contains the HPGe triple-cluster parameters for the present experiment, where $i$ denotes the cluster number used in the Miniball setup. 
	The geometry is used for the Doppler correction, which is discussed in \autoref{ssec:Doppler}.}
	\label{fig:HPGe}
\end{figure}


\section{The data acquisition system}
Signals from the CD and the HPGe clusters are read out by the ADC, TDC and Digital Gamma Finder (DGF) modules and sent to a Personal Computer (PC) in the Data AcQuisition (DAQ) room at ISOLDE. 
The data is then stored in a PC. 
The ADCs and DGFs record an energy and a time-stamp with 25 ns ticks. 
It is the multiplicity of the output of the DGFs that is used to generate the \ga\ signal, which in turn is used to make the particle-\ga\ coincidence.

The collection of data is done by the \MBOU\ \cite{Maraboou, Maraboou-web} DAQ system \cite{MB-spect}. 
It is split in two parts, as presented in \autoref{fig:MARaBOOU}, one front-end part based on the Multi Branch System (MBS) \cite{MBS} and one back-end part based on the ROOT framework \cite{ROOT}.
The front-end takes care of data readout, event building and data transportation, while the back-end takes care of the setup, run control, histogramming, data analysis and data storage. 

The system can manage high counting rates without much dead time. 
For a detection system, the dead time is the time after a readout of events where the system is unable to record another event. 
The ADCs and TDCs can buffer up to 32 events at a time \cite{MB-spect}. 
Essentially, the largest limitation to the DAQ system is pile-up, which is when the detection system starts processing another event before the previous event was finished. 
The events adds on top of each other, which leads to loss of information from both events.

During an experiment, the ROOT back end is mostly used to inspect the experiment live. 
As will be detailed in \autoref{ch:DA}, the offline ROOT analysis is very time consuming, and is largely performed after the experiment. 
This is the main part of the thesis.

\begin{figure}[ht]
	\centering
	\includegraphics[width=\linewidth]{Images/MARaBOOU.png}
	\caption{\protect\MBOU\ tasks, adapted from \cite{Maraboou}.}
	\label{fig:MARaBOOU}
\end{figure}


\section{The time structure}
In \autoref{fig:ITS}, a schematic of the ISOLDE time structure is displayed. 
The Miniball data acquisition occurs during two time windows, the "on-beam" and "off-beam" windows. 
When REXEBIS releases the beam to the HIE-ISOLDE LINAC, a signal to generate the on-beam window is sent. 
This window, called the "slow extraction mode" was 800 $\mu$s, but in 2011 it was extended to 1 ms, as the beam extraction method was improved. 
All the data are read out after the on-beam window. 
During a readout, the DAQ becomes dead for a little while, so the next window is triggered when the DAQ is operable again.
The off-beam window starts 60 $\mu$s after the end of a readout of the on-beam window.
This allow the ADCs and TDCs time to start again.
The time structure of ISOLDE makes it possible to record data again in the off-beam window, before the next beam bunch is sent from REXEBIS.
In the off-beam window, which has the same duration of time as the on-beam window, data recordings of the background is conducted.
After the off-beam window closes, a readout of the records is triggered.
It is then possible to subtract the off-beam window from the on-beam, obtaining only the beam contribution. 
The next on-beam window is triggered when the DAQ is operable again.
The DAQ system records the signals from each detector segment, which is individually time-stamped. 
With these records, a full reconstruction of the real events and coincidences are possible \cite{NWarr-el}. 

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\textwidth]{Images/Time-structure.png}
	\caption{Schematic of the ISOLDE time structure, from \cite{Gaffney}. Figure courtesy of J. van de Walle \cite{HI-TDR}. (A) The supercycle of proton beam bunches with a width of $\approx 100 ~\mu$s from the PSB separated by 1.2 s. The black vertical lines shows an allocation of the the bunches which the ISOLDE production target receives, while the others are distributed to other experiments. (B) The release profile of radionuclides from the production target, which is heavily modulated by the PSB cycle. (C+D) REXTRAP and REXEBIS beam bunches, synchronized with (E) the radio frequency (RF) window of the HIE-ISOLDE LINAC. (F) The "on-beam" and "off-beam" time window of 800 $\mu$s using the Miniball setup.}
	\label{fig:ITS}
\end{figure}


% ----------------------------------------------------------------------------------------------------------------------% ----------------------------------------------------------------------------------------------------------------------


\chapter{Data analysis}\label{ch:DA}
\epigraph{\textit{"Not everything that can be counted counts, and not everything that counts can be counted."}}{\textit{– William Bruce Cameron}}

In this chapter, the various programs and scripts applied in the detector calibration and data analysis will be introduced. 
Scripts developed in the present thesis work for the fitting procedures are slightly based on scripts written by Ville Virtanen\footnote{Ville Virtanen is a student from University of Jyväskylä.} and Dr. Liam Gaffney\footnote{Dr. Liam Gaffney is a research fellow at ISOLDE, affiliated with Miniball.}. 
The codes have been further developed and heavily re-written in the current work. 
Presently the code has only a minor resemblance to the original code. 
The remaining Python and bash scripts are written and developed by the author.
All of the scripts written in C/C++ are dependent on the ROOT 6 framework, a C/C++ data analysis framework developed and maintained at CERN.

Information about the computer setup and environment can be found in \autoref{a:computer_environment}. There is also a section containing the relative path of programs, scripts and files from this thesis.

All of my scripts are available in my GitHub repository found at \\ \url{https://github.com/wiggoen/MasterThesis}.

\section{Data handling}
The raw data from Miniball experiments essentially\footnote{The format is not entirely correct, since it has identification of where the particle and \ga\ hit. 
A more detailed format is: identification, time, particle energy (front strip, back strip), \ga\ energy (cluster, crystal, segment), etc.} comes in list mode (identification, energy, time), where every line is an event. 
It is stored in \textit{.med}-files, MBS Event Data or also known as Miniball Event Data, with the naming convention \textit{140Sm\_208Pb\_pos6\_0xy.med} for this experiment, where \textit{x} and \textit{y} are numbers between 0 and 9. 
The goal of the data analysis is to obtain Doppler-corrected \ga-spectra with various conditions on particles and angles, in order to analyze the Coulomb excitation of \Sm. 

%\begin{lstlisting}[language=]
%$ cd ~/GitHub/MasterThesis/Raw_data/Sm
%$ root 140Sm_208Pb_pos6_008_OnBeam.root
%root [1] tr->Show(10)
%======> EVENT:10
% Event           = (BuiltEvent*)0x7f8db0469010
% fUniqueID       = 0
% fBits           = 33554432
% ebisTime        = 16936792
% t1Time          = 0
% superCycleTime  = 65948
% eventNumber     = 100
% subEventNumber  = 12
% dgfData         = (vector<DgfData>*)0x7f8db04690c0
% dgfData.fUniqueID = 0
% dgfData.fBits   = 33554432
% dgfData.fModuleNumber = 18
% dgfData.fChannel = 0
% dgfData.fMultiplicity = 1
% dgfData.fEventTime = 40774
% dgfData.fEnergy = 583
% dgfData.fFastTriggerTime = 40799
% dgfData.fLongFastTriggerTime = 16949087
% dgfData.fUserValues[6] = 26112 , 60811 , 32766 , 0 , 38240 , 60811
%\end{lstlisting}

For Miniball experiment data, the preferred sorting and analysis code is \textsl{MiniballCoulexSort} \cite{MBCS}. 
The main steps of how to download, install\footnote{If the \textbf{make} step fails, try doing a \textbf{make clean} and then \textbf{make}. The program might think that it is already built.} and use it is outlined in the \textit{README.md} file in the GitHub repository of Miniball, linked in the reference. 
The program is written in C/C++ and depends on the ROOT framework. 
It is under constant development at CERN-ISOLDE under the management of Dr. Liam Gaffney. 
Unfortunately the code isn't very well documented, so it takes some time to learn what it does and how to use it. 
To get from the raw data to the Doppler-corrected \ga-spectra, the code is divided into a three step procedure:

\begin{enumerate}
	\item \texttt{MedToRoot}
	\begin{itemize}
		\item converts the raw data to ROOT format
	\end{itemize}
	\item \texttt{TreeBuilder} / \texttt{AQ4Sort}
	\begin{itemize}
		\item event building
		\begin{itemize}
			\item calibrate detectors and apply thresholds
			\item use particle-\ga\ coincidences (correlations) to build events \textcolor{red}{hører kanskje egentlig til CLXAna..}
			\item store everything in a three structure for easy access
		\end{itemize}
	\end{itemize}
	\item \texttt{CLXAna}
	\begin{itemize}
		\item apply gates on particles and perform Doppler correction
		\item Coulomb excitaiton analysis
	\end{itemize}
\end{enumerate}

\bigskip

\texttt{MedToRoot} in \autoref{sec:data_conversion}.

\texttt{TreeBuilder} will be discussed in \autoref{ssec:online_cal}.

\texttt{AQ4Sort} in \autoref{ssec:user_cal}.

\texttt{CLXAna} in \autoref{ssec:gamma}.

\texttt{kinsim3} in \autoref{ssec:kinsim}

\bigskip

\textcolor{red}{flytte til der det er litt mer relvant?}\newline
For the CD, \texttt{TreeBuilder} sorts each quadrant for itself, but it is not possible to see each pixel of the detector. 
In the front, each annular strip can be viewed and in the back each radial strip can be viewed as a whole, the back strip contains the energy information of all of the 16 annular strips. 
The radial strips cover a wide angular range, thus they show no sharp peaks as displayed by \autoref{fig:th_b}.
\texttt{TreeBuilder} also takes a number of command line flag options. 
If the \textit{-cdpad} flag option is not used, then there will be no particle events, because they come into the CD. 
Other flag options will be introduced later in the chapter.

One program that is mentioned in the Miniball GitHub repository, but not showed how to use, is the \texttt{AQ4Sort}. 
It is used in the same way as the \texttt{TreeBuilder} script, but it sorts the histograms in another way and it does not take any command line flag options. 
\texttt{AQ4Sort} is used before and during the calibration of the particle detector, because it gives information about every single ring and every single back strip, the "pixels" of the CD. 
These pixels are used for calibration and are made by gating on the annular (front) rings to see peaks in the radial (back) strips. 




\subsection{Counting and naming convention}
The numbering of the CD rings and strips are different in different programs and scripts. 
Histograms sorted by \texttt{TreeBuilder} starts counting from 0 (outermost ring) to 15 (innermost ring) as showed in \autoref{fig:CD-FB}. 
\texttt{AQ4Sort} starts from 1 (outermost ring) to 16 (innermost ring), shifted compared to \texttt{TreeBuilder}.
For calibrated spectra, \texttt{TreeBuilder} shows the energy in MeV, while \texttt{AQ4Sort} shows energy in keV.
The simulation program \texttt{kinsim3} counts from 1 (innermost ring) to 16 (outermost ring), the opposite of \texttt{AQ4Sort}. 
It is easy to be confused by all the different counting, but this thesis will try to use the counting order of \texttt{kinsim3} for the CD, it seems like the most logic way of counting. 
\autoref{tab:ADC} shows the CD wiring.
A change of the wiring of the CD will probably not happen, but it is possible to choose a logic order of counting software wise.
\autoref{tab:TBvsAQ4} shows a comparison of the logic counting and the histogram naming from \texttt{TreeBuilder} and \texttt{AQ4Sort}.
Calibration coefficients given to the calibration file, which is introduced in later sections, follow the naming convention of \texttt{TreeBuilder} in \autoref{tab:TBvsAQ4}.





\section{Data conversion}\label{sec:data_conversion}
In order to analyze the data in the ROOT framework, the first part of the code is just to convert the \textit{.med}-files produced by \MBOU\ into \textit{.root}-files with the program \texttt{MedToRoot}. 
To avoid copy and paste the commands used with \texttt{MedToRoot} in the terminal for every data file, a bash script called \texttt{M2R.sh} was made to do this. 
It uses \texttt{MedToRoot} to take in as many files as you want, and convert it in one go. 
It takes one command line argument because it was initially developed to convert files from different elements, so it is fairly simple to expand. 
If no command line arguments are given, the script will print out how to use it.
First, all of the interesting raw data files are converted with the \texttt{M2R.sh} script. 
An example of the use with terminal output for the \textit{140Sm\_208Pb\_pos6\_0xy.med}-file with \textit{xy = 08} is as follows: \textcolor{red}{flytte eksemplet til appendix?}

% Empty language = plain text
\begin{lstlisting}[language=]
$ cd ~/GitHub/MasterThesis/Scripts/sorting
$ ./M2R.sh Sm
opening file ../../Raw_data/Sm/140Sm_208Pb_pos6_008.med ...
EventBuffer::EventBuffer(GlobalSettings *)
Processing event number       0
Start trigger #14

Processing event number  130000
Stop trigger #15


Unpacked 132802 events:
wrong dgf hit pattern:                      0 ( 0.0 %)
wrong adc headers:                          0 ( 0.0 %)
# of overflows in adc channels:        599712 (451.6 %)
# of underflows in adc channels:            0 ( 0.0 %)
pattern unit mismatches:                    0 ( 0.0 %)

Number of ebis pulses:            66351
Number of t1 pulses:               2211
Number of supercycle pulses:        429
committed       1 243 951 987  bytes to tree tr, 'Tree for on beam data of Coulex setup@Miniball'
and                15 338 250  bytes to tree bg, 'Tree for on beam background data of Coulex setup@Miniball'
and               237 454 436  bytes to tree tr, 'Tree for off beam data of Coulex setup@Miniball'
wrote                  97 189  bytes to file ../../Raw_data/Sm/140Sm_208Pb_pos6_008_OnBeam.root 	=> compressed by a factor of 12799.3
,                      18 362  bytes to file ../../Raw_data/Sm/140Sm_208Pb_pos6_008_OnBeamBackground.root 	=> compressed by a factor of 835.3
,                      67 934  bytes to file ../../Raw_data/Sm/140Sm_208Pb_pos6_008_OffBeam.root 	=> compressed by a factor of 3495.4
and                    22 167  bytes to file ../../Raw_data/Sm/140Sm_208Pb_pos6_008_Scaler.root 	=> compressed by a factor of 2769.1
\end{lstlisting}

For each file converted with \texttt{MedToRoot}, the program makes four files with the naming convention
\begin{itemize}
	\item \textit{140Sm\_208Pb\_pos6\_0xy\_OnBeam.root} 
	\item \textit{140Sm\_208Pb\_pos6\_0xy\_OnBeamBackground.root}
	\item \textit{140Sm\_208Pb\_pos6\_0xy\_OffBeam.root}
	\item \textit{140Sm\_208Pb\_pos6\_0xy\_Scaler.root} 
\end{itemize}
where the file of interest is the first one. The \textit{OnBeam.root}-files are the files used in the sorting and event building with \texttt{TreeBuilder} and/or \texttt{AQ4Sort}.


\section{Detector calibration}

%\textcolor{Magenta}{Tilbakemelding: \newline 
%start with explaining the general idea for the calibration: \newline 
%determine centroids of peaks in spectra, compare with simulations (kinematics, energy loss) to get linear coefficients (gain + offset). You could show spectra for 2 rings: one where it is ok to get the 2 centroids for Sm and Pb, and one where it is difficult $\rightarrow$ use additional data (Ni?) \newline
%Sectors: cover wide angular range $\rightarrow$ no sharp peaks  \newline
%Solution: gate on rings to see peaks in sectors and calibrate. \newline
%Idea: \newline
%1. produce spectra \newline
%2. set thresholds: example, explain criteria \newline
%3. find calibration coefficients $\rightarrow$ see above \newline
%explain strategy, show examples... \newline
%4. time calibration 
%} \newline
%
%\textcolor{Magenta}{ 
%if you try to write this step-by-step cook book, you could introduce your scripts wherever is the right place to use them. 
%}\newline

The general idea of the calibration is to make sure that the energy spectra from the detectors have the same physical features, that the detectors show the same energy distribution at the same position for the same kind of particles or \ga-rays hitting the same or the angular similarly place in the detectors.
Calibration of the detectors minimize the measurement uncertainty by making the detectors more accurate and consistent.
We want to determine centroids of peaks in the spectra, compare these with simulations using kinematics of the reaction and energy loss, to get linear coefficients of the detectors. 
In this context, the centroids refer to the channels of the maximum height of the peaks or the center of the peaks. 

Both detector types in this experiment are semiconductor detectors. 
Except for silicon (as the CD), semiconductors generally require cooling to low temperatures before they can be operated. 
The basic principle of operation is that incoming ionizing radiation\footnote{For the CD, the ionizing radiation is the beam or target particles scattered from the reaction, while the ionizing radiation for the HPGe detectors is the high-energy photons (\ga) from de-excitation of the nuclei.} creates electron-hole pairs in the semi-conducting material which are then collected by an electric field. 
The number of electron-hole pairs is proportional to the energy of the incoming radiation to the semiconductor \cite{WRLeo}. 

Assuming a linear correlation between the energy $E$ of the particle (or \ga-ray) and the channel number $n$ of the ADC (or DGF), we get
\begin{equation}\label{eq:Ego}
	E = g \cdot n + a
\end{equation}
where $a$ is the offset in keV and $g$ is the gain in keV/$n$. 
The gain $g$ and the offset $a$ are the coefficients needed to do the calibration.
From \autoref{eq:Ego}, the offset $a$ can easily be expressed as 
\begin{equation}\label{eq:offset}
	a = E - g \cdot n 
\end{equation}
To find the gain $g$ in the CD denoted by $p$ for particle (or \ga\ detectors denoted by \ga), at least two measuring points are needed, e.g. the peak energy of Sm and the peak energy of Pb for a given angle (or the peak of Eu and Ba explained in \autoref{ssec:gamma}). 
The relationship can be written as 
\begin{align}\label{eq:gain}
	g_p &= \frac{E_{\text{Sm}} - E_{\text{Pb}}}{n_{\text{Sm}} - n_{\text{Pb}}}
	&
	\Bigg( g_\gamma &= \frac{E_{\text{Eu}} - E_{\text{Ba}}}{n_{\text{Eu}} - n_{\text{Ba}}} \Bigg)
\end{align}
where the peak energies are obtained from a simulation of the Coulomb excitation experiment and the channel numbers are obtained from the raw data of the actual experiment.

An assumption when calibrating is that the energy on the front side and the back side of the detector is the same. 
This is not entirely correct, since there will be a small energy loss when the particle goes through the front side, but in most cases this is negligible.


%\textcolor{red}{Si noe om time calibration (\autoref{ssec:time_cal}) og thresholds (\autoref{ssec:threshold}) her. Henvis til seksjonene.} 

%The time calibration will be discussed in \autoref{ssec:time_cal}.


\subsection{Simulation}\label{ssec:kinsim}

%\textcolor{Magenta}{Tilbakemelding: \newline 
%what are the ingredients for this simulation? \newline
%simple 2-body kinematics: energy of projectile, scattering angle of projectile $\implies$ energy of scattered projectile, \{angle, energy\} of binary partner (target recoil) \newline
%Stopping powers (which models?) $\rightarrow$ SRIM \newline
%Slowing of the particles in the target and in the dead layer of Si
%}\newline

To calibrate the data, we need to know the expected energy of the centroids of the peaks. 
This was done by simulating the experiment using the program \texttt{kinsim3} \cite{kinsim} written by Dr. Liam Gaffney. 
The purpose of the program is to simulate the kinematics of a Coulomb excitation experiment done with the CD. 
The simulations are theoretical predictions of the energy distribution of the peaks for each ring in the CD. 
\texttt{kinsim3} gives simulated spectra for the LAB and CM frame, in addition to every (annular) strip of the CD.
These strips are fitted, their energy centroids are collected and used in the calibration as shown in \autoref{ch:cd_sim}.
For stopping powers, the program uses SRIM-2013 \cite{SRIM} generated files relevant to the \textcolor{red}{??? scattering/reaction ???} with some random spread (SRIM is an acronym for the Stopping and Range of Ions in Matter).
\texttt{kinsim3} also takes into account the energy loss in the dead layer of the detector, which is energy and angle dependent. 
The simulation considers cross sections in the way that the COULEX probability increases with the CM angle ($0^\circ \implies P_{CE} = 0, 180^\circ \implies P_{CE} = 0.1539$), but the angular distribution is flat (\textcolor{red}{??? uniform ???}). 

The main function of \texttt{kinsim3} looks like this
\begin{lstlisting}[language=c++]
void kinsim3( int Zb, int Zt, double Ab, double At, 
	double thick /* mg/cm^2 */, double Eb /* MeV/u */, 
	double dEb = 0.1 /* MeV/u */, double Ex = 1.0 /* MeV */, 
	double res = 0.6 /* % */, double cd_dist = 28.0 /* mm */, 
	bool flat = false /* angular distribution? */, 
	long Nevts = 1E6, string srim_dir = "../srim" )
\end{lstlisting}
\textcolor{red}{is $x$ the channel or the energy in this case?} \newline
where \textit{Zb} and \textit{Zt} is the proton number of the beam and target respectively, \textit{Ab} and \textit{At} is the mass number of the beam and target respectively, \textit{thick} is the target thickness in mg/cm$^2$, \textit{Eb} is the beam energy in MeV/u, \textit{dEb} is the \textcolor{red}{??? distribution ???} of the beam energy in MeV/u, \textit{Ex} is the excitation energy, \textit{res} is the detector resolution in percent, \textit{cd\_dist} is the distance form the target to the CD in mm, \textit{flat} is the choice of a uniform or angular distribution, \textit{Nevts} is the number of events and \textit{srim\_dir} is the relative path of the SRIM directory.

\texttt{kinsim3} was run with the following commands in the terminal to do the simulation
\begin{lstlisting}[language=sh]
$ cd ~/GitHub/Miniball/kinsim
$ root
root [0] .L kinsim3.cc++
root [1] kinsim3(62, 82, 140, 208, 1.4, 4.65, 0.02, 1.0, 0.6, 27, false, 1e6, "../SRIM")
... <showing output from program>
root [2] .q
$ mv 140Sm_208Pb_1.4mg_4.65MeVu_d0.02MeVu_res0.6.root ../../MasterThesis/Sorted_data/sim_140Sm_208Pb.root
\end{lstlisting}
To load \texttt{kinsim3} into ROOT, the \textbf{.L $<$filename$>$} command was used. Adding the '$++$' at the end, forces ROOT to compile the code. 
After the simulation program was run, the file was moved and renamed with the \textbf{mv} command. 
\texttt{kinsim3} generates pdf-files of the stopping powers automatically. 
The rest of the plots are available inside the generated \textit{.root}-file. 
To get the energy simulation for each ring, the function \textbf{simulation\_plots()} from the script \texttt{ParticlePlot.cpp} was used. 
\begin{lstlisting}[language=sh]
$ cd ~/GitHub/MasterThesis/Scripts/plotting
$ root
root [0] .L ParticlePlot.cpp++
root [1] simulation_plot("setup_Sm.txt", 1)
... <showing output from script>
\end{lstlisting}

\autoref{ch:cd_sim} shows the simulated energy for each ring of the CD, in addition to the fitted peaks of each ring.
In the fitting of the simulated data, a Gaussian function with linear background was applied
\begin{equation}
	g(x) = c + sx + A e^{-\frac{1}{2}\left(\frac{x - \mu}{\sigma}\right)^2}
\end{equation}
where $c$ is the background constant, $s$ is the background slope, $A$ is the amplitude (Gauss constant), $\mu$ is the mean (expected value) and $\sigma$ is the standard deviation (Gauss width). 
\autoref{tab:CD_angles} shows the mid ring CD angles in the LAB frame for the front of the CD. 
A general kinematics simulation in the LAB frame is shown in \autoref{fig:kinsim}. 

\begin{table}[ht] 
    \centering 
    \caption{The mid ring CD angles in the LAB frame, with a distance from the target to the CD of 27 mm. 
    Ring 1 is the innermost ring and ring 16 is the outermost ring. 
    The centroid energies comes from simulation with \texttt{kinsim3}. 
    $E_t$ is the energy of the secondary target particle (Pb) and $E_b$ is the energy of the beam particle (Sm).}
	\input{Table-data/CD.tex}
	\label{tab:CD_angles}
\end{table}



\subsection{Online calibration of the particle detector}\label{ssec:online_cal}
Every year there is a campaign at ISOLDE, where the staff configures a settingsfile if there are any changes in the setup system. 
In addition the staff makes a calibration file containing the calibration coefficients for the CD and the \textcolor{red}{??? Miniball \ga\ detector / HPGe detector ???} array. 
For the calibration of the CD, a cocktail beam composed of different isotopes is accelerated into a specific target. 
For the calibration of the \ga\ detectors, usually two \ga\ sources are placed in the target position.
The data from these runs are used to make the calibration file. 
It contains the calibration coefficients for the ADCs and DGFs in addition to the Miniball geometry.
This calibration file is adjusted for each experiment following the campaign period.
In this way it is easy to sort and analyze during the experiments, to check if it is going well and to make preliminary Doppler-corrected \ga-spectra.
For IS558, the settingsfile \textit{MBSettings2017\_CLX\_IS558.dat} and the calibration file \textit{IS558-online.cal} was made.

The calibration step usually starts with \texttt{TreeBuilder}, which generates histograms of the CD and the \ga\ detectors separately. 
It also contains information about the timing between particles and \ga's. 
In this step, the \textcolor{red}{??? correlating / correlation ???} of particles and \ga's is started.
Just as for the \texttt{MedToRoot} program, the bash script \texttt{Q4S.sh} was made to utilize the \texttt{TreeBuilder} and \texttt{AQ4Sort} programs. 
\texttt{Q4S.sh} uses either \texttt{TreeBuilder} or \texttt{AQ4Sort} to sort a lot of data files in one go.
From \texttt{TreeBuilder}, only the front side calibration coefficients of the CD can be extracted. 
For the back side, \texttt{AQ4Sort} has to be used.
\autoref{ssec:user_cal} will go into more details about \texttt{AQ4Sort}.
When using the online calibration, we don't need to use the \texttt{AQ4Sort} program, because we already have the calibration coefficients in the \textit{IS558-online.cal} file. 
The coefficients are adjusted in the beginning and during the experiment.
The \textit{OnBeam.root}-files are loaded into \texttt{TreeBuilder} via \texttt{Q4S.sh} with the commands
\begin{lstlisting}[language=sh]
$ cd ~/GitHub/MasterThesis/Scripts/sorting 
$ ./Q4S.sh Sm online TB
... <showing output from script>
$ mv Sm_online-TreeBuilder-2019-06-24.root ../../Sorted_data/
\end{lstlisting}
After the sorting, the file was moved to a folder of sorted data with the \textbf{mv} command, and the relative path was given to the \textit{setup\_Sm.txt} file used as input in the \texttt{ParticlePlot.cpp} script. 
This script was made to extract different histograms from the \textit{.root}-file generated by either \texttt{TreeBuilder} or \texttt{AQ4Sort}.
The script has to be loaded into the ROOT framework to work, because it was built to utilize the power of the framework.
Histograms extracted from this step go through some formatting changes, to make them more presentable.
To run the \texttt{ParticlePlot.cpp} in interaction with ROOT, the following commands are used
\begin{lstlisting}[language=sh]
$ cd ~/GitHub/MasterThesis/Scripts/plotting 
$ root
root [0] .L ParticlePlot.cpp++
root [1] plot_front_back_energy("setup_Sm.txt", "online")
... <showing output from script>
\end{lstlisting}

\autoref{fig:CD_cal_online} shows the back vs. front energy (online calibration) for the one quadrant of the CD. 
The plots shows a part of a line for each front and back strip. An indication of a good calibration is when all detectors lie on a linear line ($y = x$), meaning that the front side and the back side of the CD has detected the same energy. 
From the figure we see that not all detectors fit the line, indicating that there are some calibration coefficients wrong in some of the strips.
One major problem with the online calibration is that a number of the back strips have the wrong gains as shown in \autoref{fig:CD_cal_back}.


% ParticlePlot.cpp
% get_single_plot("setup_Sm.txt", "tb", "f", 1, 4, 4, 1, 270, 670, 15500)
%\includegraphics[width=\textwidth]{../Plots/plotting/TB_Q4_F4_cal.png}


\subsection{User calibration of the particle detector}\label{ssec:user_cal}
An ambitious goal of the calibration was to make a program that could automatically fit the centroid of the peaks needed. 
It turned out to be very difficult, and it became more and more manual labor. 
Because of the complex peak shapes, it is very hard to do an automatic fitting it seems. 
As an example, \autoref{fig:CD_cal_easy} displays one strip that is easy to calibrate and \autoref{fig:CD_cal_difficult} shows one strip that is difficult to calibrate.
The peaks demands very much individual care, which is very difficult to do with a automatic program. 
In logarithmic (log) scale the data looked more Gaussian distributed, but it is not the case in linear scale. 
For the centroids, it was very hard to tell in log scale how precise the automatic fitting was. 
It turned out that it was not very precise, so a lot of time was wasted looking at the data in log scale. 

\begin{figure}[ht]
	\centering
	\begin{subfigure}[t]{0.49\textwidth}
		\centering
		% GammaPlot.cpp
		% check_single_threshold("setup_Sm.txt", "f", 4, 2, 3300, 8000)
		\includegraphics[width=\textwidth]{../Plots/plotting/Threshold_Q4_f2.png}
		\caption{}
		\label{fig:th_f}
	\end{subfigure}
	\hfill 
	\begin{subfigure}[t]{0.49\textwidth}
		\centering
		% GammaPlot.cpp
		% check_single_threshold("setup_Sm.txt", "b", 4, 6, 2700, 2000)
    		\includegraphics[width=\textwidth]{../Plots/plotting/Threshold_Q4_b6.png}
		\caption{}
		\label{fig:th_b}
	\end{subfigure}
	%\label{fig:threshold}
	\begin{subfigure}[t]{0.49\textwidth}
		\centering
		% ParticlePlot.cpp
		% get_single_plot("setup_Sm.txt", "tb", "f", 0, 4, 9, 1, 300, 2400, 1080)
		\includegraphics[width=\textwidth]{../Plots/plotting/TB_Q4_F9.png}
		\caption{}
		\label{fig:CD_cal_easy}
	\end{subfigure}
	\hfill
	\begin{subfigure}[t]{0.49\textwidth}
		\centering
		% ParticlePlot.cpp
		% get_single_plot("setup_Sm.txt", "q4", "b", 0, 1, 16, 12, 200, 1400, 330)
		\includegraphics[width=\textwidth]{../Plots/plotting/bE_Q1_f16_b12.png}
		\caption{}
		\label{fig:CD_cal_difficult}
	\end{subfigure}
	\caption{\textbf{(a)} Front strip 2 in quadrant 4. 
	At higher energies, there is a double-peak structure of \Sm. 
	The second peak of \Sm\ can be explained by region 2 from \autoref{fig:EFBQ4}
	\textbf{(b)} Back strip 6 in quadrant 4.
	\textbf{(c)} Front strip 9 in quadrant 4. 
	In this strip it is fairly easy to determine the centroids of the particles.
	\textbf{(d)} Back strip 12, gated on ring 16 (outermost ring) in quadrant 1. 
	The calibration of the CD is not always straightforward. 
	It is actually very difficult to determine where the centroid of \Pb\ is.
	See text for more information.}
	\label{fig:cal_ED}
\end{figure}

On the front side of the CD, there is effectively only two measuring points per angle interval. 
If the contaminant in the spectra was known and if it only consists of one element, it could have been a third measuring point.  
On the back side of the CD there are two peaks per gated annular strip that can be fitted, so per back strip a maximum of 32 measuring points. 
By doing a function fit, Gaussian or other, the centroids of the peaks for both Sm and Pb can be extracted. 
On the front side of the CD, \autoref{eq:offset} and \autoref{eq:gain} can be used to calculate the calibration coefficients.
For more than two centroids per strip, as the back side of the CD have, linear regression is used to find the best fit of the calibration coefficients.

Calibrating the back strips of the CD is the same as the front, however because they cover a large range of angles in the $\theta$ direction (according to the LAB frame in \autoref{fig:scattering}), a gate on one of the front strips is needed to define an angle and thereby an energy. 
For this purpose, the program \texttt{AQ4Sort} is used. 
It operates the same files as \texttt{TreeBuilder} does, but with the purpose of making every combination of gates on front and back strips so that the front and back centroids for every "pixel" of the detector is available.

The total amount of annular strips to calibrate on the front side of the CD is 64, since there is 4 quadrants with 16 rings. 
On the back side, there is effectively 48 radial strips, 4 quadrants with 12 strips.
To fully calibrate the CD, we need all the centroids of the peaks from both sides, 128 centroids (64 annular strips $\cdot$ 2 peaks/strip) on the front side and 1536 centroids (48 radial strips $\cdot$ 2 peaks/strip $\cdot$ 16 rings) on the back side. 
This gives a total of 1664 centroids to extract, which is not a task one would like to do manually.
For a quick calibration, or a bare minimum calibration, one needs two peaks in each annular strip and two peaks in each radial strip, making it 224 centroids.
By taking more centroids, which is generally a good idea, it is possible to check for non-linearities or instabilities in time.
It makes the calibration more precise.
One would like to have calibration coefficients for low, mid and high energies, e.g. from ring 1, 8 and 16 as a minimum to cover the angular distribution.

\autoref{fig:cal_FC} shows a flowchart of the programs, scripts and files used in the user calibration. 
The idea was to use the \textbf{kinsim3()} function from \texttt{kinsim3.cc} to simulate the data and the \texttt{Q4S.sh} script to sort the experimental data with \texttt{AQ4Sort} to get each pixel of the CD. 
This data could either be analyzed in ROOT with the \textbf{TBrowser()} or through different functions in \texttt{ParticlePlot.cpp}. 
From either ROOT or \texttt{ParticlePlot.cpp}, information about the range of the peaks and guesses of the centroids of Pb and Sm would be written down in input files used in \texttt{ParticleFit.cpp}. 
Here the automatic fitting would have used the input files to fit the peaks, collect the centroids and written them to output files which would have been used as input files in \texttt{particle-calibration.py}. 
In this Python script, the centroids would have been plotted and a linear regression method using least squares of a first degree polynomial fit \cite{Polyfit} would have fitted a line to re-produce the points as best as possible. 
It would also write the gains and offsets to separate output files, which would be used as input in \texttt{ADC\_generator.py}. 
This Python script will write the calibration coefficients to the terminal, and from there it is possible to copy and paste it into the calibration file \textit{IS5558-user.cal}. 
This calibration file is then used to sort the data once more with \texttt{Q4S.sh} using \texttt{TreeBuilder} and the new calibration coefficients.
To visualize plots after a new calibration, either ROOT or \texttt{ParticlePlot.cpp} can be used. 
The gray boxes related to the \ga-calibration will be discussed in \autoref{ssec:gamma}.

\begin{figure}[ht]
	\centering
	%\input{Images/Calibration-flow-chart.tikz}
	\includegraphics[width=0.8\textwidth]{Images/Flowchart.png}
	\caption{Flowchart of the programs, scripts and files used in the user calibration. The relative paths of these programs and scripts are shown in \autoref{tab:paths}.}
	\label{fig:cal_FC}
\end{figure}

The downfall of the automatic centroid collector came when trying it on the radial strips of the CD. 
There is just too much individual differences to calibrate the radial strips with a simple script given a channel range for all 12 back strips. 
This was discovered way too late. 
There isn't any range to "rule them all", at least since the fitting function can behave very strange given a too small or too big range.
Another problem is the complex shape of the peaks.
To implement a proper automatic fitting program, one would have to find a function with a negatively-skewed distribution, where most of the data values are concentrated on the right side of the distribution graph. 
Sadly this was discovered too late to implement it. 

In some spectra it was very hard to determine the centroid of the Pb peaks, as shown in \autoref{fig:CD_cal_difficult}. 
To try to solve this problem, additional data from an experiment conducted right before this one was applied. 
The experiment was IS553, $^{144}$Ba on $^{58}$Ni, and the reason for trying additional data was to try to get calibration for the lower energy spectra. 
But sadly the data from the IS553 experiment was a bad fit with this experiment. 
Unfortunately there is no way of knowing if a data set is useful or not until it is tested. 
It may be that the energy loss or target thickness was wrong, or that the beam energy was different, or that the simulation didn't account for all the details of the stopping. 
The only way to get a good calibration is to have as much data as possible and then kick out the bad data until there is a good fit. 
What was clear at the moment was that the scatter between the data points from the different reactions was too large to simply average out with a straight line fit. 
It is important to select data that agree.
The fitting just didn't seem reliable.
It gave a steeper slope than the online calibration.
By looking at the front vs. back energy plots, the diagonal lines were almost disappearing in the middle, and they were a lot broader than the online calibration. 
One big problem of not using the IS553 data, was that it was not possible to get any good calibration coefficients for front ring 16 and maybe also ring 15.
But this problem was also found in the IS553 data.
It would have been nice with some low-energy points as well as high-energy points in order to do the calibration. 
The user calibration did appear to get worse in a few aspects. 
Firstly, the diagonal line in the front vs. back energy spectra was not as defined as the online calibration.
Secondly, the off-diagonal events seemed to increase, implying that there was an increase in the mismatch of front and back events. 
The latter could be due to the visualization coming from the $z$-scale, since there are a different number of events in the quadrants. 

Looking at the energy vs. channel plots, it was clear that something was not good.
It was clear that a Gaussian fit did not work. 
Since the Gaussian distribution was a bad fit for the experimental data, a built in function in ROOT of a 4th degree polynomial was tried out to fit the complex peak shapes. 
The predefined ROOT function 
\begin{equation}
	f(x) = p_0 + p_1 \cdot x + p_2 \cdot x^2 + p_3 \cdot x^3 + p_4 \cdot x^4
\end{equation}
sets the initial values of the parameters automatically. 
Only a initial guess of the parameters have to be given.
It turned out that this did not match the peak shapes either. 

It was anyways decided to stick with the online calibration for this thesis since there is no time to do a new calibration of the detectors. 
A lot of time have been used on scripts, and then the auto-fitting was a much harder problem than first expected because of the shape of the peaks.
The user calibration of the CD is basically the online calibration without the innermost ring. 
An explanation of why the innermost ring was removed can be found in  \autoref{sec:BDS}. 
As \autoref{fig:EFBQ4} shows, the calibration of the CD got better by removing the innermost ring. 
The most visibly lines which did not fit $y = x$ vanished, implying that most of the problem was in fact the coefficients of ring 1. 

\begin{figure}[htb]
	\centering
	\begin{subfigure}[t]{0.49\textwidth}
		\centering
		% ParticlePlot.cpp
		% plot_single_front_back_energy("setup_Sm.txt", 1, "online")
		\includegraphics[width=\textwidth]{../Plots/plotting/E_f_b_Q1-online.png}
		\caption{}
		\label{fig:CD_cal_online}
	\end{subfigure}
	\hfill
	\begin{subfigure}[t]{0.49\textwidth}
		\centering
		% ParticlePlot.cpp
		% plot_single_front_back_energy("setup_Sm.txt", 4, "user")
		\includegraphics[width=\textwidth]{../Plots/plotting/E_f_b_Q4-user-drawing.png}
		\caption{}
		\label{fig:EFBQ4}
	\end{subfigure}
	%
	\begin{subfigure}[t]{0.49\textwidth}
		\centering
		% ParticlePlot.cpp
		% single_CD_energy("setup_Sm.txt", "b", 1)
		\includegraphics[width=\textwidth]{../Plots/plotting/E_vs_b-strip_Q1.png}
		\caption{}
		\label{fig:CD_cal_back}
	\end{subfigure}
	\caption{Back energy vs. front energy for one quadrant of the CD in (a+b). 
	(a) Quadrant 1 using online calibration.
	(b) Quadrant 4 using user calibration. A similar figure to figures 39 and 40 in \cite{Rosiak}.
	(c) Quadrant 1 of the back side of the CD. A number of the radial strips have the wrong gains.
	See text for more information.}
	\label{fig:FBE}
\end{figure}

In several strips in quadrant 1 and 4, there was a double-peak structure of \Sm\ like the one in \autoref{fig:th_f}. 
To explain this we have to look at the two-dimensional (2D) spectrum in \autoref{fig:EFBQ4}, which can be divided into four parts \cite{Rosiak}:
\begin{itemize}
	\item Region 1: The measured energy at the front and back side of the CD are equal, which indicates that they are linearly correlated.
	\item Region 2: In these events the detected energy is lower at the back side, while at the front side the energy is artificially increased. 
	One explanation of this is if the energy is detected in one strip on the front side, but is shared between two neighboring strips on the back side.
	The reduced energy on the back side only occurs when the impact position is close to or inside the dead layer between two strips. 
	The current from the two neighboring strips can possibly induce an artificially higher energy to the front side of the CD. 
	A similar phenomenon has been observed in segmented HPGe detectors discussed in detail in \cite{Bruyneel2006a, Bruyneel2006b, Bruyneel, Descovich2005, Abt2017}.	
	Another explanation is that there are some charge trapping and charge recombination of the particle-hole pairs. 
	This causes a Pulse-Height Defect (PHD) in the detector signal, which is discussed in detail in \cite{Miller1962, Wilkins1971}.
	
	The second Sm-peak at higher energies in \autoref{fig:th_f} comes from the projection of the 2D spectrum from \autoref{fig:EFBQ4} onto the x-axis.
	\item Region 3: This area has a similar, but different pattern to region 2. 
	The detected energy is lower at the front side, while it is higher at the back side of the CD. 
	Here, the reduced energy on the front side originates from charge sharing between neighboring annular strips if the incoming particle hits close to or inside the dead layer. 
	 On the back side, the strips are coupled to a positive voltage which protects against the induction of an artificially higher energy by the front side charge sharing. 
	These phenomena are discussed in detail in \cite{Grassi2014, Kramberger2002}.
	\item Region 4: This structure originates from the same place as region 2.
	These events occur because of the paired up radial strips on the back side of the CD.  
	Because of the connection of two neighboring strips, the charge is split among them and it is added up to the total charge.
\end{itemize}

%\begin{figure}[ht]
%	\centering
%	\begin{subfigure}{\textwidth}
%		\centering
%		% ParticlePlot.cpp
%		% plot_front_back_energy("setup_Sm.txt", "online")
%		\includegraphics[width=\textwidth]{../Plots/plotting/E_f_b_Q1-4-online.png}
%		\caption{Online calibration for the CD showing the four quadrants. It generally looks quite good, but there is a number of the radial strips (back side) that have the wrong gains.}
%		\label{fig:CD_cal_online}
%	\end{subfigure}
%	\begin{subfigure}{\textwidth}
%		\centering
%		% ParticlePlot.cpp
%		% plot_front_back_energy("setup_Sm.txt", "user")
%		\includegraphics[width=\textwidth]{../Plots/plotting/E_f_b_Q1-4-user.png}
%		\caption{User calibration for the CD showing the four quadrants. This is actually the online calibration without the innermost ring, which was broken.}
%		\label{fig:cal_FB}
%	\end{subfigure}
%	\caption{Back energy vs. front energy for each quadrant of the CD.}
%	\label{fig:cal_OU}
%\end{figure}
% -------------------------------------------------------------------------------------------------
%\begin{figure}[ht]
%	\centering
%	\begin{subfigure}{\textwidth}
%		\centering
%		% ParticlePlot.cpp		
%		% CD_energy("setup_Sm.txt", "f")
%		\includegraphics[width=\textwidth]{../Plots/plotting/E_vs_f-strip_all_Q.png}
%		\caption{CD front. Ring number 16 is the outermost ring and ring number 1 is the innermost ring.}
%		\label{fig:cal_CD_front}
%	\end{subfigure}
%	%%
%	%%
%	\caption{Energy vs. strip number for each quadrant of the CD.}
%	\label{fig:cal_CD}
%\end{figure}

An example of how to use \texttt{Q4S.sh} with \texttt{TreeBuilder} is shown below
\begin{lstlisting}[language=]
$ cd ~/GitHub/MasterThesis/Scripts/sorting 
$ ./Q4S.sh Sm user TB
--- TreeBuilder ---
input file(s):
... <shows a list of all input files>
output file: Sm_user-TreeBuilder-2019-06-20.root
calibration file: ../../Miniball-config/IS558-user.cal
WeightPR: 0.75
Particle distribution:
 Q0 fired: 12243817
 Q1 fired: 12277727
 Q2 fired: 11479362
 Q3 fired: 10936096
Finished.
$ mv Sm_user-TreeBuilder-2019-06-20.root ../../Sorted_data/
\end{lstlisting}
In the output, there is a line reading WeightPR: 0.75. 
This parameter is needed when calibrating the \ga\ detectors explained in \autoref{ssec:gamma}. 
A similar example of how to use \texttt{Q4S.sh} with \texttt{AQ4Sort} is shown below
\begin{lstlisting}[language=]
$ ./Q4S.sh Sm user Q4
Info: No flag option for 'AQ4Sort'. Ignoring optional flag.
--- AQ4Sort ---
calibration file: ../../Miniball-config/IS558-user.cal
input file(s):
... <shows a list of all input files>
output file: Sm_user-AQ4Sort-2019-06-24.root
$ mv Sm_user-AQ4Sort-2019-06-24.root ../../Sorted_data/
\end{lstlisting}



\bigskip

\textcolor{red}{Skal jeg forklare mer om "the fitting procedure" i denne seksjonen?}



\subsection{Threshold}\label{ssec:threshold}
The continuum of events at low energy comes from charge sharing between the strips.
\autoref{fig:th_f} and \autoref{fig:th_b} shows the big peak of the charge sharing on the front and back side of the CD respectively. 
This peak is called the "pedestal", because it is like a massive statue in front of the interesting data. 
For the very heavy ions, the total amount of charge deposited gets split between neighboring strips of the CD. 
There is a single common gate for each ADC, containing channels from one CD quadrant. 
Therefore, when there is an event in one strip of the CD, all channels are read out, but the channels without a real event read a "zero" energy.
These are the events in the pedestal.
A software threshold is applied to cut away the pedestal. 
For each ADC channel, the threshold can, and should be set. 
One should define the threshold for each ADC channel to be above this peak.
After a correct calibration is applied, the pedestal will be calibrated out of the physical energy range.

%\begin{figure}[ht]
%	\centering
%	\begin{subfigure}{\textwidth}
%		\centering
%		% ParticlePlot.cpp
%		% check_pedestal("setup_Sm.txt", "f", 2, 4, 60)
%		\includegraphics[width=\textwidth]{../Plots/plotting/Pedestal_Q2_f4.png}
%		\caption{Pedestal from annular strip 4 in quadrant 2.}
%		\label{fig:Pedestal_f}
%	\end{subfigure}
%	\begin{subfigure}{\textwidth}
%		\centering
%		% ParticlePlot.cpp
%		% check_pedestal("setup_Sm.txt", "b", 3, 8, 70)
%		\includegraphics[width=\textwidth]{../Plots/plotting/Pedestal_Q3_b8.png}
%		\caption{Pedestal from radial strip 8 in quadrant 3.}
%		\label{fig:Pedestal_b}
%	\end{subfigure}
%	\caption{The pedestal from charge sharing in the front and back side of the CD.}
%	\label{fig:Pedestal}
%\end{figure}

\textsl{MiniballCoulexSort} does perform some tricks to try to recover the correct energy and position of the particles, but that depends on counting the number of strips that fire. 
The default threshold is set to channel 100 if none is given in the calibration file.
In some cases this is too much and in others this is not enough. 
If the threshold is set too low, pedestal events are included and it will get things wrong. 
If the threshold is too high, some events that have charge sharing will be missed and this leads to getting the wrong energy for the particle.
The goal is to not include the pedestal, and don't cut away too many events from the continuum.
It is easier to set thresholds in linear scale than logarithmic, because in log scale the threshold value will decrease very much and it is difficult to see where to set the limit. 
\autoref{fig:th_f} and \autoref{fig:th_b} shows the software threshold set in the user calibration file on the front and back side for one strip on each side.
These values were also put into the online calibration file.


%% BIG FIGURE, 4 plots ++

%\begin{figure}[ht]
%	\centering
%	\begin{subfigure}{\textwidth}
%		\centering
%		% ParticlePlot.cpp
%		% check_single_threshold("setup_Sm.txt", "f", 1, 11, 2100, 1500)
%		\includegraphics[width=\textwidth]{../Plots/plotting/Threshold_Q1_f11.png}
%		\caption{Annular strip 11 in quadrant 1.}
%		\label{fig:Threshold_f}
%	\end{subfigure}
%	\begin{subfigure}{\textwidth}
%		\centering
%		% ParticlePlot.cpp
%		% check_single_threshold("setup_Sm.txt", "b", 1, 6, 2800, 1500)
%		\includegraphics[width=\textwidth]{../Plots/plotting/Threshold_Q1_b6.png}
%		\caption{Radial strip 6 in quadrant 1.}
%		\label{fig:Threshold_b}
%	\end{subfigure}
%	\caption{The threshold, marked with a red dotted line, set for one front and one back strip of the CD.}
%	\label{fig:Threshold}
%\end{figure}


The key spectra to look at are \autoref{fig:CD_debug} and \autoref{fig:part_wcut}. 
\autoref{fig:CD_debug} shows how many particles have strips fired on the front side or back side of the CD. 
It counts how many particles have $x$ strips fired on the front side and $y$ strips fired on the back side. 
The table added to \autoref{fig:CD_debug} explains the different debug IDs. 
The goal is to have a lot more counts in CD debug ID 0 compared to ID 3.
If we have too many debug ID = 3, then the threshold is too low. 
If we have a large continuum/background in \autoref{fig:part_wcut}, the thresholds are too high. 
The best thing to do is to play about with different values to see what is best.
Debug ID 20 is when no particle can be found, because there is no energy registered in either the front or the back strips. 
This can only happen when the front energy is below the software threshold set by the user in the calibration file and the back energy is either in a broken strip or is also below the software threshold. 
It is likely that it is some noise events or charge sharing that comes below the threshold. 

%\begin{figure}[ht]
%	\centering
%	% ParticlePlot.cpp
%	% energy_vs_ring("setup_Sm.txt")
%	\includegraphics[width=\textwidth]{../Plots/plotting/E_vs_ring_all.png}
%	\caption{Energy vs. ring number all quadrants of the CD combined. The upper yellow curve is \Sm, the middle one is \Pb\ and the lower one is the contaminant. Ring 1, which is removed, is the innermost ring and ring 16 is the outermost ring.}
%	\label{fig:part}
%\end{figure}

\begin{figure}[htb]
	\centering
	\begin{subfigure}[b]{0.49\textwidth}
		\centering
		% ParticlePlot.cpp
		% check_cd_debug("setup_Sm.txt", "user")
		\includegraphics[width=\textwidth]{../Plots/plotting/cd_debug-user.png}
		\caption{}
	\end{subfigure}
	\hfill
	\begin{subfigure}[b]{0.49\textwidth}
		\centering
    		\input{Table-data/CD_debug.tex} \newline % newline lifts the table up one line
    		\caption{}
	\end{subfigure}
	\caption{(a) A histogram of the CD debugging. The IDs on the $x$-axis are explained by the table in (b). The IDs show the number of strips fired at the front and back side of the CD.}
	\label{fig:CD_debug}
\end{figure}


\subsection{Time calibration}\label{ssec:time_cal}
The purpose of the time calibration is to align the time spectra so that a prompt time gate can be set. In this way it is possible to correlate particles and \ga-rays. Using the \texttt{ParticlePlot.cpp} script, the ADC time offset spectra can be extracted by the following commands
\begin{lstlisting}[language=sh]
$ cd ~/GitHub/MasterThesis/Scripts/plotting
$ root
root [0] .L ParticlePlot.cpp++
root [1] check_ADC_time_offsets("setup_Sm.txt")
\end{lstlisting}
or they can be manually reached by
\begin{lstlisting}[language=sh]
$ cd ~/GitHub/MasterThesis/Sorted_data
$ root Sm_user-TreeBuilder-2019-06-20.root
root [1] new TBrowser()
\end{lstlisting}
In the browser, the histograms are named \textit{tdiff\_gp\_i}, where \textit{i} is a number between 0 and 3 implying quadrant 1 to 4. 
They lie within the \textit{.root}-file without a folder. \autoref{fig:ADC_dt} shows the time offsets for the CD. 
The peaks of these plots have the interesting $x$-axis values. 
Zooming into the peaks, it is very clear what the value in each quadrant is. 
The values can change depending on the amount of data sorted, so it is wise to double check them when more data is added to the \textit{.root}-file. 
After the peak values have been collected, they should be written into the calibration file under ADC time offsets (ticks). 
The time offsets of this experiment was the following
\begin{lstlisting}[language=sh]
# ADC time offsets (ticks)
adc_0.TimeOffset:  0
adc_1.TimeOffset:  -2
adc_2.TimeOffset:  -3
adc_3.TimeOffset:  5
\end{lstlisting}
After the software threshold and ADC time offsets are added to the calibration file, a re-run of the \texttt{Q4S.sh}-step with \texttt{TreeBuilder} and the updated calibration file has to be conducted.

\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth]{../Plots/plotting/tdiff_gp_0-3-user.png}
	\caption{ADC time offsets for the four quadrants of the CD.}
	\label{fig:ADC_dt}
\end{figure}



\subsection{Calibration of the \texorpdfstring{$\gamma$}{gamma} detectors}\label{ssec:gamma}
The online calibration of the \ga\ detectors is quite good for most detectors in a certain energy range, because it is designed to be that way. 
During the setup of the experiment, a hardware calibration of the \ga\ detectors was performed. 
The gains of each DGF are matched so that the online analysis is more straightforward.
However, there are non-linearities and drifting offsets and gains over time that have to be corrected for with a proper calibration using the \Ba\ and \Eu\ source data collected in the end of the experiment. The \Ba\ and \Eu\ sources are placed at the target position simultaneously, back to back, and the data is also used to determine the relative efficiency of the Miniball spectrometer. 

Histograms used for \ga\ detector calibration sorted by \texttt{TreeBuilder} use the naming convention $\textit{E\_gam\_seg}\_c\_d\_s$, where $c \in [0, 7]$ is the cluster number, $d \in [0, 2]$ is the detector number and $s \in [0, 6]$ is the segment number, where $s = 0$ is actually the core signal, as displayed in \autoref{fig:HPGe}.
There was no time to do a proper calibration of the \ga\ detectors in this thesis, but the online calibration was quite good anyways.
Just as for the particle calibration, scripts for \ga\ detector calibration was supposed to be made. 
The gray boxes in \autoref{fig:cal_FC} are related to the \ga\ detector calibration. 
The idea was to use the \texttt{Q4S.sh} script to sort the experimental data with \texttt{TreeBuilder}.
Then use \texttt{GammaPlot.cpp} or ROOT to analyze the data using the \ga-histograms mentioned above. 
Information about the peaks should have been used as input in \texttt{GammaFit.cpp}, where the fitting would have taken place. 
The Python scripts \texttt{DGF\_generator.py} and \texttt{Geometry\_generator.py} does at the moment reproduce the calibration coefficients and geometry parameters from the online calibration. 
These were supposed to be changed to fit the proper calibration in time.  
The output from these scripts should have been copied and pasted into the calibration file \textit{IS558-user.cal}.
\autoref{ssec:Doppler} explains why it is important to know the geometry of the \ga\ detector setup.
After the calibration coefficients and the geometry parameters are added to the calibration file, a re-run of the \texttt{Q4S.sh}-step with \texttt{TreeBuilder} and the updated calibration file has to be conducted. 
The next step is to do a Doppler correction, which is explained in  
\autoref{ssec:Doppler}. 

After the Doppler correction the \texttt{CLXAna} program needs to be used. \textcolor{red}{Er egentlig denne som tar seg av Doppler correction og lager histogram...}


 in order to get the Doppler-corrected \ga-spectra to analyze the Coulomb excitation of \Sm.

\texttt{CLXAna} makes event trees and energy spectra for both particle and \ga\ detection which can be used for analyzing the Coulomb excitation events.


\bigskip


\textcolor{red}{The \textit{-s} flag (singles) is for adding particles which come without a \ga-ray and the \textit{-addback} flag is for adding Compton scattered events together in the Miniball clusters.}

\textcolor{red}{\textbf{Then I have misunderstood the singles method?}}

There are three methods of sorting the events from Miniball; singles, add-back and reject. 
When applying the singles method, every \ga-ray entering a detector is counted as an event.
There are no assumptions of Compton scattering in this kind of sorting. 
This implies that some of the events counted as true events are in fact scattered \ga's corresponding to a different energy.
When utilizing the add-back method, events occurring in neighboring detectors in the same cluster within a 100 ns time window are added together as a single event. 
The energies of the events that occurred in the separate segments are summed, and the segment with the highest energy is assumed to be the position of the incident \ga-ray.
An advantage of the add-back method is that the full energy of a single \ga-ray, which has undergone a Compton scattering process, can be reconstructed to increase the efficiency.
A disadvantage of the method is the uncertainty in the assumptions of the addition of several events into a single event. 
The timing resolution cannot distinguish true \ga-\ga\ events from Compton scattering events.
The add-back method can cause an increase in the intensity of \ga-ray sum peaks since it has no way to deal with pile-up of different \ga-rays, thus no correction is performed when different \ga-rays pile up in the detector \cite{Gaffney, MB-spect}.
When applying the reject method for the sorting, events occurring in neighboring detectors in the same cluster within a 100 ns time window is excluded as an event. 
The total statistics for the reject method will therefore be smaller. 
If the amount of total statistics is large, it is possible and maybe even advantageous to apply the reject method, because it will give a higher probability of getting the actual full energy peaks of the \ga-rays detected. 

All input parameters for \texttt{CLXAna} are stated in the GitHub repository of \textsl{MiniballCoulexSort}, but they are not explained in detail. 
From private communications with Dr. Liam Gaffney, some of the input parameters now have a little more context
\begin{description}[align=left]
	\item [-c] The configuration file is a file that contains all of the input parameters, except "-cut", in order to not type the parameters into the command line each time.
	\item [-cut] The cut file  is a root file containing the graphical cuts on the kinematics from the particle histogram, "part" in the output file of \texttt{CLXAna}. 
	This is the only file path that is not possible to put into the configuration file as stated above. 
	\newline It seems a bit weird that the input of \texttt{CLXAna} is dependent on one of its output histograms, but it is the way it is for now. 
	\item [-Ex] Excitation energy of the state that you want to perform the Doppler correction for, given in keV. This is not a significant value.
	\item [-depth] The depth of the interaction in the target in mg/cm$^2$. 
	Usually assumed to be half of the thickness of the target. 
	Different values can be tested to see if it improves the Doppler correction.
	\item [-cdoffset] The rotation of the CD detector in the $\phi$ angle, with a default value of 242.6 degrees. 
	This can be optimized, but the value is usually around the default value.
	\item [-deadlayer] The thickness of the Si dead layer in mm, with a default value of 0.0007 mm.
	\item [-spededist] Not needed for this experiment.
	\item [-bg\_frac] This value depends on the time windows defined in TreeBuilder, which means it should be -0.75 for the current version. 
	The number can also be checked by taking the ratios of the $\beta$-decay background peaks in the prompt gammas ("p") and random gammas ("r") spectra in the output file of \texttt{CLXAna}.
\end{description}
As mentioned in \autoref{ssec:user_cal}, one line in the output from \texttt{Q4S.sh} using \texttt{TreeBuilder} was
\begin{lstlisting}[language=]
WeightPR: 0.75
\end{lstlisting}
This value is the one supposed to be used with the \textbf{-bg\_frac} input parameter when using \texttt{CLXAna}.
Even though the WeightPR value is positive, the input parameter is supposed to be negative.  
In this thesis, the input parameters used with \texttt{CLXAna} can be found in the \textit{config-IS558.dat} file.

The first time \texttt{CLXAna} is run, every input parameter except \textbf{-cut} needs to be provided. 
A plot \textcolor{red}{??? sier man histogram om et plott? eller er histogram kun 1D? har vært litt ukonsistent her. ???} of energy vs. LAB angle named "part" is needed in order to make the cut file, and this plot is found inside the \textit{.root}-file sorted by \texttt{CLXAna}.
It would have been more logical to include this plot in \texttt{TreeBuilder}, but for some reason it is not. 
There is also a plot named "part" inside the \textit{.root}-file sorted by \texttt{TreeBuilder}, but this contains energy vs. annular strip.
To make the cut file, the "part" plot from the output file of \texttt{CLXAna} needs to be opened.
It is also advised to use log scale on the $z$-axis, the draw option "colz" and to zoom into the correct area.
From this plot, graphical cuts around the beam-like and target-like particles needs to be done separately. 
After making the cuts, right click and SetName to set the names to "Bcut" and "Tcut" respectively. 
Then right click and SaveAs, giving the name of a \textit{.root}-file of your choice for each cut separately. 
The key is the \textit{.root} extension so that it knows which format to use. 
In this thesis, the files were saved as \textit{Bcut.root} and \textit{Tcut.root} respectively.
The two files can be added together using a ROOT program called \texttt{hadd}, which is used like this
\begin{lstlisting}[language=]
hadd outputfile.root input_file_1.root input_file_2.root 
\end{lstlisting}
If the files are supposed to be saved somewhere else, the absolute path can be given.
With the cut files above, this step was done by
\begin{lstlisting}[language=]
$ cd ~/GitHub/ROOT-framework/build/bin
$ hadd /Users/trondwj/GitHub/MasterThesis/Sorted_data/outputfile.root /Users/trondwj/GitHub/MasterThesis/Sorted_data/Bcut.root /Users/trondwj/GitHub/MasterThesis/Sorted_data/Tcut.root 
\end{lstlisting}

Now that the cut file is made, a second run of \texttt{CLXAna} can be performed. 
In order to not copy and paste all command into the command line, a script named \texttt{Coulex.sh} was made to sort the data with \texttt{CLXAna}. 
It uses the configuration file \textit{config-IS558.dat} and the cut file \textit{outputfile.root}. 
In addition it takes one command line flag of the four different options of sorting the data
\begin{lstlisting}[language=]
'-d' (default)
'-s' (singles) 
'-a' (addback) 
'-r' (reject)
\end{lstlisting}
An example of running the script and the output given by \texttt{CLXAna} is shown below
\begin{lstlisting}[language=]
$ ./Coulex.sh -d
--- Coulex: default ---
Input parameters:
Zb = 62
Ab = 140
Zt = 82
At = 208
Eb = 4650 keV/u
Ex = 531 keV
thick = 1.4 mg/cm2
depth = 0.7 mg/cm2
cddist = 27 mm
cdoffset = 242.6 degrees
deadlayer = 0.0007 mm
contaminant = -1 mg/cm2
spededist = 23.6 mm
bg_frac = -0.75
srim = /Users/trondwj/GitHub/MasterThesis/SRIM
cutfile = ../../Sorted_data/outputfile.root:Bcut:Tcut
Begin g_clx loop.
Info in <TCanvas::Print>: pdf file /Users/trondwj/GitHub/MasterThesis/SRIM/140Sm_208Pb.pdf has been created
Info in <TCanvas::Print>: pdf file /Users/trondwj/GitHub/MasterThesis/SRIM/208Pb_208Pb.pdf has been created
Info in <TCanvas::Print>: pdf file /Users/trondwj/GitHub/MasterThesis/SRIM/140Sm_Si.pdf has been created
Info in <TCanvas::Print>: pdf file /Users/trondwj/GitHub/MasterThesis/SRIM/208Pb_Si.pdf has been created
Initialising histograms...
Looping over events...
Warning in <TClass::Init>: no dictionary for class trevts is available
1-particle events = 89020258%)    
Finished.
\end{lstlisting}
As seen above, the cut file \textit{outputfile.root} is provided as  
\begin{lstlisting}[language=]
outputfile.root:Bcut:Tcut
\end{lstlisting}
The \textit{:Bcut:Tcut} ending are the names of the cuts in the file. The first cut is the beam-like and the second is the target-like. 
These names can be chosen otherwise, but they must match the names set in the first step. 

\autoref{fig:part_wcut} shows the cuts of the beam and target for the detected particle events. 
These cuts are used in the Doppler correction of the \ga-rays. 
\textcolor{red}{Hva mer kan jeg si?} 

\begin{figure}[htb]
	\centering
	\begin{subfigure}[t]{0.49\textwidth}
		\centering
		% GammaPlot.cpp
		% particle_events_with_cut()
		\includegraphics[width=\textwidth]{../Plots/plotting/particle-events-wcut.png}
		\caption{}
		\label{fig:part_wcut}
	\end{subfigure}
	\hfill 
	\begin{subfigure}[t]{0.49\textwidth}
		\centering
    		\includegraphics[width=\textwidth]{../Plots/simulation/kin_140Sm_208Pb.png}
		\caption{}
		\label{fig:kinsim}
	\end{subfigure}
	\caption{Detected and simulated particle events of \Sm\ on \Pb\ at 4.65 MeV/u in the LAB frame. Smaller angles corresponds to the inner rings and larger angles to the outer rings.
	(a) Detected particle events. The upper curve marked inside the full lines is the Sm and the lower curve marked inside the dotted lines is the Pb. The contaminant is underneath the Pb area. 	
	(b) Simulated kinematics. The upper curve is the Sm and the lower curve is the Pb.
	}
	\label{fig:part_events}
\end{figure}




\autoref{fig:B_dcB_cid} ... \textcolor{red}{what can I say about this plot?}

\begin{figure}[ht]
	\centering
	% GammaPlot.cpp
	% beam_gated_dcB_gammas_core("setup_Coulex.txt", "d")
	\includegraphics[width=\textwidth]{../Plots/plotting/B_dcB_cid.png}
	\caption{Beam gated prompt, Doppler corrected \ga-rays. Core ID 20 is removed, see \autoref{sec:BDS}.}
	\label{fig:B_dcB_cid}
\end{figure}


\autoref{tab:DGF}, \textcolor{red}{not sure how to make this table. How is the histogram names and the calibration coefficients linked? Not exactly straightforward.}

\begin{table}[ht] 
	\centering 
	\caption{DGF}
	\input{Table-data/DGF.tex}
	\label{tab:DGF}
\end{table}



%The Miniball spectrometer \cite{MB-spect} \newline
%p. 8: \newline
%\textbf{Efficiency and resolution:}
%left bottom: \newline
%The application of an add-back (AB) routine involves the summing of the energies of two coincident gamma rays within 100 ns in neighboring cores on the same cluster detector. This situation corresponds to a Compton-scattered \ga-ray event where the energy of the \ga-ray is shared between two or more crystals in the same triple cluster detector. For higher-energy \ga-rays, where scattering from one crystal into its neighbor is quite likely, this improves the efficiency, but for low-energy \ga-rays, where scattering is less likely, summing effects actually reduce the efficiency. For this reason a cut-off is normally applied and AB is only performed for energies above this threshold. \newline





\subsection{Doppler correction}\label{ssec:Doppler}
\textcolor{red}{Does this belong in the theory chapter?}\newline
In order to perform the Doppler correction, the interaction point angles in the Miniball frame of reference has to be known. 
\autoref{fig:HPGe} shows a sketch of the Miniball cluster geometry and the associated table gives the angles and distance of the different clusters.
The parameters $\theta$, $\phi$ and $R$ describes the position of the central axis of the detector clusters, while $\alpha$ describes the orientation about the axis of the cluster. 
All these parameters are needed to calculate the position of the segments or the position of a point determined by the pulse-shape analysis. 
The interaction point is determined either from the segment with the largest energy or using a pulse-shape analysis. 
In the first case, the position of the center of each segment has to be known.
In the second case, geometrical information to relate the time-to-steepest slope and ratio of the mirror charge amplitudes to the angle between the interaction point, the target and the emitted particle need to be known. 
This is built into \texttt{MiniballCoulexSort}, which does the geometrical calculations. 
The geometry parameters of the Miniball clusters has to be written into the calibration file. 




Because of the significant velocity of the scattered particles, the emitted \ga-rays from the particle de-excitation has a Doppler shifted \ga\ energy given by 
\begin{equation}\label{eq:DS}
	E_\gamma = \frac{E_\gamma^{'}}{\gamma (1 - \beta \cos \theta)}
\end{equation}
where $E_\gamma$ is the \ga\ energy detected in the LAB frame, $E_\gamma^{'}$ is the \ga\ energy in the nucleus' frame of reference, $\beta = \frac{v}{c}$, $v$ is the nucleus' velocity, $c$ is the speed of light, $\theta$ is the angle of the emitted \ga-ray with respect to the nucleus' direction of motion and $\gamma = 1/\sqrt{1 - \beta^2}$ is the Lorentz factor. Since both the CD and the HPGe array are segmented, the emission angle $\theta$ of the \ga-ray can be calculated by 
\begin{equation}\label{eq:DSA}
	\cos \theta = \sin \theta_p \sin \theta_\gamma \cos (\phi_p - \phi_\gamma) + \cos \theta_p \cos \theta_\gamma
\end{equation}
where ($\theta_p, \phi_p$) and ($\theta_\gamma, \phi_\gamma$) are the detection angles of the particle and \ga-ray respectively, ($\theta_p, \theta_\gamma$) are the angles with respect to the beam axis and ($\phi_p, \phi_\gamma$) are the azimuthal angles \textcolor{red}{??? er det forståelig hva azimuthal angles er ???} \cite{RIBF2012, MB-spect}. The Doppler correction factor is found by combining \autoref{eq:DS} and \autoref{eq:DSA} into
\begin{equation}
	\frac{E_\gamma^{'}}{E_\gamma} = \gamma (1 - \beta (\sin \theta_p \sin \theta_\gamma \cos (\phi_p - \phi_\gamma) + \cos \theta_p \cos \theta_\gamma))
\end{equation}





\subsection{Broken detector segments}\label{sec:BDS}
The innermost ring of the CD was very damaged by the bombardment of particles hitting it, so it had to be removed from the data set. 
It was impossible to separate the beam and target peaks as shown by \autoref{fig:BDS_R1}.
This was unfortunate since ring 1 has the most statistics. 
Si detectors don't last forever, it was "old" and supposed to be changed after our experiment. 
The inner ring is the most vulnerable because of the high energy impact. 

On the back side of the CD, one pixel was acting weird compared to the other back strips in the same quadrant. 
Radial strip 1 (B1) gated on annular strip 16 in quadrant 4 showed a lot more counts than all of the other strips as shown by \autoref{fig:BDS_B1}. 
There was also other rings where B1 was a bit off, but not nearly as much as in the named pixel. 
Maybe B1 should have been excluded from the data set, but it was not in this thesis.

In \autoref{fig:B_dcB_cid}, core ID 20 was removed because it was a broken segment. 
Core ID 15 shows fewer counts than the neighbors, this is because it was a crosstalk issue involving a dead segment in detector 18A (cluster 5, core 0, segment 1 and 2). 
Crosstalk is the phenomenon where a signal transmitted on one channel creates an undesired effect in another channel. 
It means that some events had to be vetoed to avoid double-peaking, and this reduces the efficiency.



%\begin{figure}[ht]
%	\centering
%	\begin{subfigure}{\textwidth}
%		\centering
%		% plot_quadrants("setup_Sm.txt", "f", 1, 0, 1, 0, 3500, 8500)
%		\includegraphics[width=\textwidth]{../Plots/plotting/Q1-4_f1.png}
%		\caption{CD front ring 1 (innermost ring). It is impossible to separate \Pb\ from \Sm.}
%		\label{fig:BDS_R1}
%	\end{subfigure}
%	\begin{subfigure}{\textwidth}
%		\centering
%		% plot_back_strips("setup_Sm.txt", 4, 16, 0, 0, 1700, 400)
%		\includegraphics[width=\textwidth]{../Plots/plotting/bE_Q4_f16_b1-12.png}
%		\caption{CD back strip 1 gated on front ring 16 (outermost ring) in quadrant 4. B1 shows a lot more counts than the other strips arount channel 800.}
%		\label{fig:BDS_B1}
%	\end{subfigure}
%	\caption{Broken detector segments in the CD.}
%	\label{fig:BDS}
%\end{figure}

%\begin{figure}[ht]
%		\centering
%		% plot_back_strips("setup_Sm.txt", 4, 16, 0, 0, 1700, 400)
%		\includegraphics[width=\textwidth]{../Plots/plotting/bE_Q4_f16_b1-12.png}
%		\caption{CD back strip 1 gated on front ring 16 (outermost ring) in quadrant 4. B1 shows a lot more counts than the other strips arount channel 800.}
%		\label{fig:BDS_B1}
%\end{figure}


\begin{figure}[ht]
	\centering
	\begin{subfigure}[t]{0.49\textwidth}
		\centering
		% ParticlePlot.cpp
		% get_single_plot("setup_Sm.txt", "tb", "f", 0, 1, 1, 1, 0, 2500, 8000)
		\includegraphics[width=\textwidth]{../Plots/plotting/TB_Q1_F1.png}
		\caption{}
		\label{fig:BDS_R1}
	\end{subfigure}
	\hfill
	\begin{subfigure}[t]{0.49\textwidth}
		\centering
		% ParticlePlot.cpp
    		% plot_back_strips("setup_Sm.txt", 4, 16, 0, 0, 1700, 400)
		\includegraphics[width=\textwidth]{../Plots/plotting/bE_Q4_f16_b1-12.png}
		\caption{}
		\label{fig:BDS_B1}
	\end{subfigure}
	\caption{Broken detector strips in the CD.
	(a) Ring 1 in quadrant 1. It is impossible to separate \Pb\ from \Sm.
	(b) CD back strip 1 gated on front ring 16 (outermost ring) in quadrant 4. B1 shows a lot more counts than the other strips arount channel 800.}
	\label{fig:BDS}
\end{figure}




Excluding detector strips is easy, the only thing to do is to set gain and offset to $-1$, or gain to $0$ and offset to $-1$. 
That will make the energy calibration negative, and fall out of the scope. 
It is the way it is usually done for dead CD strips or dead \ga\ detectors. 


% ----------------------------------------------------------------------------------------------------------------------% ----------------------------------------------------------------------------------------------------------------------


\chapter{Experimental results and discussion}
\epigraph{\textit{"In physics, you don't have to go around making trouble for yourself – nature does it for you."}}{\textit{– Frank Wilczek}}


Very pure beam (\textcolor{red}{did we have statistics of this?}) - resultat til avhandling. sjekk etter doppler-korrigering. Nd-contaminasjon? i så fall veldig lite, 1-2 prosent?

\textcolor{Magenta}{Tilbakemelding: \newline
we would have to look at the \ga-spectra to identify any contaminants. There may be a little bit of Nd-140 in the beam, but if so, it is very little (judging from on-line spectra).}


\bigskip


Level scheme (from Klintefjord?)\newline

\textcolor{Magenta}{Tilbakemelding: \newline
at some point you should show the level scheme. \newline
$\bullet$ motivation: to explain what is known, and which transition probabilities you want to measure.  \newline
Perhaps also to explain what theory predicts. \newline
$\bullet$ discussion: if you get \ga-spectrum for \Sm\ $\rightarrow$ to explain what you see.}


\begin{figure}[ht]
	\centering
	\input{Images/Level-scheme-140Sm-v2.tikz}
	\caption{Level scheme for \Sm, based on \cite{Klintefjord, NNDC-levels}. The energies are given in keV.}
	\label{fig:levels}
\end{figure}

\bigskip

\autoref{fig:gg_dcB} ...

\begin{figure}[ht]
	\centering
	% GammaPlot.cpp
	% gg_matrix_dcB("setup_Coulex.txt", "d")
	\includegraphics[width=\textwidth]{../Plots/plotting/gg_dcB.png}
	\caption{\ga-\ga\ matrix, Doppler corrected for beam.}
	\label{fig:gg_dcB}
\end{figure}


\autoref{fig:gam_dcB} ...

\begin{figure}[ht]
	\centering
	% GammaPlot.cpp
	% gg_matrix_dcB("setup_Coulex.txt", "d")
	\includegraphics[width=\textwidth]{../Plots/plotting/gam_dcB.png}
	\caption{Total statistics for \ga-rays, 
      background subtracted, Doppler corrected for scattered projectile.}
	\label{fig:gam_dcB}
\end{figure}



% ----------------------------------------------------------------------------------------------------------------------% ----------------------------------------------------------------------------------------------------------------------

\chapter{Summary and outlook}
\epigraph{\textit{"Nothing happens until something moves."}}{\textit{– Albert Einstein}}


Future work: Better calibration of particle detectors and \ga\ detectors (online not perfect). Take into account the shape of the peaks $\implies$ calibrate the particle detectors manually.. Takes a lot of time! But maybe less than trying to fit all in a script? If someone only knew and told this story...

Use a second opinion on the simulation, maybe try LISE++ or some other simulation program to get the centroids?
Maybe \texttt{kinsim3} uses too much energy loss in CD? 
If you are using only the Pb and Sm for calibration, and then applying that calibration back to the data, then it should matter if the absolute energies are correct. 
This is an internal calibration, so that would simply mean that the peaks would have the wrong energy, but they should still be aligned on the front and back.


\bigskip

Geometry:
For the geometry, I am not sure exactly what the best set of angles are. You should produce some spectra to analyse before determining this. In the output file of CLXAna you will find a histogram called B\_dcB\_cid, which is the Doppler corrected spectra vs. each detector. The peak energies should of course be constant as a function of detector number, if they vary, then the angles need to be improved.


\bigskip


In the Sm data, the issue came in determining the peak centroid or maximum for the experimental data. 
The peak shape is a convolution of many effects; intrinsic resolution of the detector, the beam energy width, straggling in the target, interaction points in the target, angular width of the detector strip, etc. 
While the simulation tries to include all these things, it was found that the peak shapes were not exactly the same. 
It might be worthwhile spending a bit of time to play with the parameters and try to get the peak shape as similar as possible. 
At that point, maybe use a certain feature of the peak, such as the maximum, or the highest energy edge. 
Or, honestly, it might be better to simply hover the mouse over the correct "feature" of the peak and position it by eye, be it the centroid or the maximum.
Then the same feature in the corresponding simulated spectrum can be analyzed.
The maximum of the peak on the high energy side is not the center of the peak, but roughly equivalent to the maximum. 
It can be imagined as fitting a Gaussian to the right-hand side, the high-energy side only, as this would be roughly where the centroid is. 


\bigskip

Efficiency calibration ++

\bigskip

\textcolor{red}{Fra oppgaveteksten:} \newline
determine Coulomb excitation yields. These yields will then, in a second step, be compared to theoretical calculations and transition probabilities and quadrupole moments will be extracted using chi-square minimization procedures.


GOSIA and GOSIA2 analysis?

\url{https://www.pas.rochester.edu/~cline/Gosia/Gosia_Manual_20110609.pdf}

\bigskip

Look for an updated version of \textsl{MiniballCoulexSort} and ask Dr. Liam Gaffney if there are any new considerations of how to use it with data from 2017.

\bigskip

Coulomb excitation yields. These yields will then, in a second step, be compared to theoretical calculations and transition probabilities and quadrupole moments will be extracted using chi-square minimization procedures.

\bigskip

Expect to measure transition probabilities $B(E2)$ and quadrupole moment (nuclear deformation). 



% ----------------------------------------------------------------------------------------------------------------------% ----------------------------------------------------------------------------------------------------------------------




% ----------------------------------------------------------------------------------------------------------------------% ----------------------------------------------------------------------------------------------------------------------

\begin{appendices}

\chapter{Acronyms and abbreviations}

\begin{table}[ht] 
	\centering 
	%\caption{Table of acronyms and abbreviations.}
	\input{Table-data/Acronyms-and-abbreviations.tex}
	\label{tab:acro}
\end{table}


% ----------------------------------------------------------------------------------------------------------------------% ----------------------------------------------------------------------------------------------------------------------

\chapter{Symbol list}

\begin{table}[ht]
  \centering
  \caption{Table of symbols with explanations.}
    \begin{tabular}{ll}
        \hline
        T$_{1/2}$ & Half-life \\
        \hline
    \end{tabular}
    \label{tab:symbols}
\end{table}

% ----------------------------------------------------------------------------------------------------------------------% ----------------------------------------------------------------------------------------------------------------------

\chapter{Two-particle elastic collision}\label{ch:scattering}
\section{Laboratory (LAB) frame of reference}\label{sec:LAB}
The angles of the two-particle collision in the laboratory frame from \autoref{fig:scattering} is calculated in this section. 
A general approach is used to make it easier to hold track of the parameters. 
From the figure we can express the velocities as
\begin{align}\label{eq:2p-LAB-collision}
\begin{split}
	 \boldsymbol{u} &= \boldsymbol{u}_1 = u \boldsymbol{\hat{x}}  \\
	 \boldsymbol{u}_2 &= 0  \\
	 \boldsymbol{v}_b &= \boldsymbol{v}_1 = v_1 (\cos \theta \boldsymbol{\hat{x}} + \sin \theta \boldsymbol{\hat{y}})  \\
	\boldsymbol{v}_t &= \boldsymbol{v}_2 = v_2 (\cos \varphi \boldsymbol{\hat{x}} - \sin \varphi \boldsymbol{\hat{y}})
\end{split}
\end{align}
where $\boldsymbol{u}_1$ and $\boldsymbol{v}_1$ is the initial and final velocity of the projectile $m_b = m_1$ respectively, and $\boldsymbol{u}_2$ and $\boldsymbol{v}_2$ is the initial and final velocity of the target $m_t = m_2$ respectively. The angles $\theta_b = \theta$ and $\theta_t = \varphi$ are the projectile and target angle respectively. We also introduce a ratio of the projectile mass to the target mass, $\alpha = m_1/m_2$.

Conservation of momentum gives
\begin{align*}%\label{eq:comom}
	m_1 \boldsymbol{u}_1 &= m_1 \boldsymbol{v}_1 + m_2 \boldsymbol{v}_2
\end{align*}
which in $x$-direction can be expressed as
\begin{align}\label{eq:comx}
	m_1 u &= m_1 v_1 \cos \theta + m_2 v_2 \cos \varphi  \nonumber\\
	m_1 (u - v_1 \cos \theta) &= m_2 v_2 \cos \varphi  \nonumber\\
	\frac{m_1}{m_2} (u - v_1 \cos \theta) &= v_2 \cos \varphi  \nonumber\\
	\alpha (u - v_1 \cos \theta) &= v_2 \cos \varphi
\end{align}
and in $y$-direction can be expressed as
\begin{align}\label{eq:comy}
	0 &= m_1 v_1 \sin \theta - m_2 v_2 \sin \varphi \nonumber\\
	m_1 v_1 \sin \theta &= m_2 v_2 \sin \varphi \nonumber\\
	\frac{m_1}{m_2} v_1 \sin \theta &= v_2 \sin \varphi \nonumber\\
	\alpha v_1 \sin \theta &= v_2 \sin \varphi
\end{align}

Conservation of energy gives
\begin{align}\label{eq:coe}
	\tfrac{1}{2} m_1 \boldsymbol{u}_1^2 &= \tfrac{1}{2} m_1 \boldsymbol{v}_1^2 + \tfrac{1}{2} m_2 \boldsymbol{v}_2^2 \nonumber\\
	\tfrac{1}{2} m_1 (u^2 - v_1^2) &= \tfrac{1}{2} m_2 v_2^2 \nonumber\\
	\frac{m_1}{m_2} (u^2 - v_1^2) &= v_2^2 \nonumber\\
	\alpha (u^2 - v_1^2) &= v_2^2
\end{align}

We now have three equations, \autoref{eq:comx} - \autoref{eq:coe}, with four unknown quantities ($v_1, \theta, v_2, \varphi$). 
Using the target angle $\varphi$ as an independent variable, we can find expressions for the other three variables. 

Squaring \autoref{eq:comx} 
\begin{align*}%\label{eq:c}
	\alpha^2 (u - v_1 \cos \theta)^2 &= v_2^2 \cos^2 \varphi  \\
	\alpha^2 (u^2 - 2uv_1 \cos \theta + v_1^2 \cos^2 \theta) &= v_2^2 \cos^2 \varphi
\end{align*}
and \autoref{eq:comy}
\begin{align*}%\label{eq:c}
	\alpha^2 v_1^2 \sin^2 \theta &= v_2^2 \sin^2 \varphi
\end{align*}
and adding them together gives
\begin{align}\label{eq:av}
	\alpha^2 (u^2 - 2uv_1 \cos \theta + v_1^2 \cos^2 \theta + v_1^2 \sin^2 \theta) &= v_2^2 (\cos^2 \varphi + \sin^2 \varphi)  \nonumber\\
	\alpha^2 (u^2 - 2uv_1 \cos \theta + v_1^2) &= v_2^2  \nonumber\\
	\alpha^2 u^2 - 2\alpha^2 uv_1 \cos \theta + \alpha^2 v_1^2 &= v_2^2  \nonumber\\
	\alpha^2 v_1^2 &= -\alpha^2 u^2 + 2\alpha^2 uv_1 \cos \theta + v_2^2  \nonumber\\
	\alpha^2 v_1^2 &= -\alpha^2 u^2 + 2\alpha u (\alpha v_1 \cos \theta) + v_2^2
\end{align}
From \autoref{eq:comx} we have
\begin{align}\label{eq:comx2}
	\alpha (u - v_1 \cos \theta) &= v_2 \cos \varphi  \nonumber\\
	\alpha u - \alpha v_1 \cos \theta &= v_2 \cos \varphi  \nonumber\\
	\alpha v_1 \cos \theta &= \alpha u - v_2 \cos \varphi
\end{align}
Substituting for \autoref{eq:comx2} into \autoref{eq:av} we get
\begin{align}\label{eq:comsq}
	\alpha^2 v_1^2 &= -\alpha^2 u^2 + 2\alpha u (\alpha u - v_2 \cos \varphi ) + v_2^2  \nonumber\\
	\alpha^2 v_1^2 &= -\alpha^2 u^2 + 2\alpha^2 u^2 - 2\alpha u v_2 \cos \varphi + v_2^2  \nonumber\\
	\alpha^2 v_1^2 &= \alpha^2 u^2 - 2\alpha u v_2 \cos \varphi + v_2^2
\end{align}
Using \autoref{eq:coe} we get
\begin{align}\label{eq:coesub}
    \left( \frac{\alpha}{\alpha} \right) \alpha (u^2 - v_1^2) &= v_2^2  \nonumber\\
    \alpha^2 (u^2 - v_1^2) &= \alpha v_2^2  \nonumber\\
	\alpha^2 u^2 - \alpha^2 v_1^2 &= \alpha v_2^2  \nonumber\\
	\alpha^2 v_1^2 &= \alpha^2 u^2 - \alpha v_2^2
\end{align}
Combining \autoref{eq:comsq} and \autoref{eq:coesub} gives
\begin{align}\label{eq:comcoe}
    \alpha^2 u^2 - 2\alpha u v_2 \cos \varphi + v_2^2 &= \alpha^2 u^2 - \alpha v_2^2  \nonumber\\
    v_2^2 + \alpha v_2^2 &= 2\alpha u v_2 \cos \varphi  \nonumber\\
    v_2^2 (1 + \alpha) &= 2\alpha u v_2 \cos \varphi  \nonumber\\
    v_2 &= 2 \left( \frac{\alpha}{1 + \alpha} \right) u \cos \varphi 
\end{align}
Substituting \autoref{eq:comcoe} into \autoref{eq:coesub} we get
\begin{align}\label{eq:coesubsub}
    \alpha^2 v_1^2 &= \alpha^2 u^2 - \alpha \left( 2 \left( \frac{\alpha}{1 + \alpha} \right) u \cos \varphi  \right)^2  \nonumber\\
    v_1^2 &= u^2 - \frac{1}{\alpha} \left( 4 \left( \frac{\alpha^2}{(1 + \alpha)^2} \right) u^2 \cos^2 \varphi  \right)  \nonumber\\
    v_1^2 &= u^2 \left(1 - 4 \left( \frac{\alpha}{(1 + \alpha)^2} \right) \cos^2 \varphi  \right)  \nonumber\\
    v_1 &= u \sqrt{1 - 4 \frac{\alpha}{M} \cos^2 \varphi}
\end{align}
where $\alpha/M = \alpha/(1 + \alpha)^2$. 
The ratio of \autoref{eq:comy} and \autoref{eq:comx2} gives
\begin{align}\label{eq:comxy}
	\frac{\alpha v_1 \sin \theta}{\alpha v_1 \cos \theta} &= \frac{v_2 \sin \varphi}{\alpha u - v_2 \cos \varphi}  \nonumber\\
	\tan \theta &= \frac{v_2 \sin \varphi}{\alpha u - v_2 \cos \varphi}
\end{align}
Inserting \autoref{eq:comcoe} into \autoref{eq:comxy} gives
\begin{align}\label{eq:tanBgen}
	\tan \theta &= \frac{\left( 2 \left( \frac{\alpha}{1 + \alpha} \right) u \cos \varphi  \right) \sin \varphi}{\alpha u - \left( 2 \left( \frac{\alpha}{1 + \alpha} \right) u \cos \varphi  \right) \cos \varphi}  \nonumber\\
	\tan \theta &= \frac{\alpha u \left( \frac{1}{1 + \alpha} \right) 2 \sin \varphi \cos \varphi}{\alpha u \left(1 - 2 \left( \frac{1}{1 + \alpha} \right) \cos^2 \varphi \right)}  \nonumber\\
	\tan \theta &= \frac{\sin 2\varphi}{(1 + \alpha)\left(1 - 2 \left( \frac{1}{1 + \alpha} \right) \cos^2 \varphi \right)}  \nonumber\\
	\tan \theta &= \frac{\sin 2\varphi}{1 + \alpha - 2 \cos^2 \varphi}  \nonumber\\
	\tan \theta &= \frac{\sin 2\varphi}{\alpha - (2 \cos^2 \varphi - 1)}  \nonumber\\
	\tan \theta &= \frac{\sin 2\varphi}{\alpha - \cos 2\varphi}  \nonumber\\
	\theta &= \arctan \left( \frac{\sin 2\varphi}{\alpha - \cos 2\varphi} \right)
\end{align}
Substituting back the variable names from the LAB frame in \autoref{fig:scattering} into \autoref{eq:tanBgen} gives
\begin{align}\label{eq:tanB}
	\theta_b &= \arctan \left( \frac{\sin 2\theta_t}{\alpha - \cos 2\theta_t} \right)
\end{align}


\section{Center of mass (CM) frame of reference}
Using the same approach as \autoref{sec:LAB}. 
From the CM frame in \autoref{fig:scattering} we can express the velocities as
\begin{align}\label{eq:2p-CM-collision}
\begin{split}
	 \boldsymbol{u}_1^{'} &= u_1^{'} \boldsymbol{\hat{x}} \\
	 \boldsymbol{u}_2^{'} &= u_2^{'} \boldsymbol{\hat{x}} \\
	 \boldsymbol{v}_b^{'} &= \boldsymbol{v}_1^{'} = v_1^{'} (\cos \theta^{'} \boldsymbol{\hat{x}} + \sin \theta^{'} \boldsymbol{\hat{y}}) \\
	\boldsymbol{v}_t^{'} &= \boldsymbol{v}_2^{'} = v_2^{'} (-\cos \theta^{'} \boldsymbol{\hat{x}} - \sin \theta^{'} \boldsymbol{\hat{y}}) = -v_2^{'} (\cos \theta^{'} \boldsymbol{\hat{x}} + \sin \theta^{'} \boldsymbol{\hat{y}})
\end{split}
\end{align}
where $\boldsymbol{u}_1^{'}$ and $\boldsymbol{v}_1^{'}$ is the initial and final velocity of the projectile $m_b = m_1$ respectively, and $\boldsymbol{u}_2^{'}$ and $\boldsymbol{v}_2^{'}$ is the initial and final velocity of the target $m_t = m_2$ respectively. 
The angle $\theta_b^{'} = \theta^{'}$ is the projectile angle. 

In the center of mass (CM) frame of reference, the position of the center of mass is given by
\begin{align}\label{eq:CMpos}
	\boldsymbol{R} &= \frac{m_1 \boldsymbol{r}_1 + m_2 \boldsymbol{r}_2}{m_1 + m_2}
\end{align}
and the velocity is
\begin{align}\label{eq:Vcm}
	\boldsymbol{V} &= \frac{d\boldsymbol{R}}{dt}
	= \frac{d}{dt} \left( \frac{m_1 \boldsymbol{r}_1 + m_2 \boldsymbol{r}_2}{m_1 + m_2} \right)
	= \frac{m_1 \boldsymbol{u}_1^{'} + m_2 \boldsymbol{u}_2^{'}}{m_1 + m_2}
\end{align}
At the origin of the CM frame, $\boldsymbol{R} = 0$, which implies $\boldsymbol{V} = 0$. 
The total momentum before the collision is
\begin{align}\label{eq:ucm}
	m_1 \boldsymbol{u}_1^{'} + m_2 \boldsymbol{u}_2^{'} &= 0  \nonumber\\
	m_2 u_2^{'} &= -m_1 u_1^{'} \nonumber\\
	u_2^{'} &= - \frac{m_1}{m_2} u_1^{'} \nonumber\\
	u_2^{'} &= - \alpha u_1^{'}
\end{align}
and after the collision it is
\begin{align}\label{eq:vcm}
	m_1 \boldsymbol{v}_1^{'} + m_2 \boldsymbol{v}_2^{'} &= 0  \nonumber\\
	m_2 \boldsymbol{v}_2^{'} &= -m_1 \boldsymbol{v}_1^{'} \nonumber\\
	\boldsymbol{v}_2^{'} &= - \frac{m_1}{m_2} \boldsymbol{v}_1^{'} \nonumber\\
	\boldsymbol{v}_2^{'} &= - \alpha \boldsymbol{v}_1^{'} \nonumber\\
	-v_2^{'} (\cos \theta^{'} \boldsymbol{\hat{x}} + \sin \theta^{'} \boldsymbol{\hat{y}}) &= - \alpha v_1^{'} (\cos \theta^{'} \boldsymbol{\hat{x}} + \sin \theta^{'} \boldsymbol{\hat{y}}) \nonumber\\
	v_2^{'} &= \alpha v_1^{'}
\end{align}
Conservation of energy gives
\begin{align}\label{eq:coecm}
	\tfrac{1}{2} m_1 u_1^{'2} + \tfrac{1}{2} m_2 u_2^{'2} &= \tfrac{1}{2} m_1 v_1^{'2} + \tfrac{1}{2} m_2 v_2^{'2} \nonumber\\
	m_1 u_1^{'2} + m_2 u_2^{'2} &= m_1 v_1^{'2} + m_2 v_2^{'2}
\end{align}
Substituting \autoref{eq:ucm} and \autoref{eq:vcm} into \autoref{eq:coecm} gives
\begin{align}\label{eq:u2u1}
	m_1 u_1^{'2} + m_2 (-\alpha u_1^{'})^2 &= m_1 v_1^{'2} + m_2 (\alpha v_1^{'})^2 \nonumber\\
	m_1 u_1^{'2} + \alpha^2 m_2 u_1^{'2} &= m_1 v_1^{'2} + \alpha^2 m_2 v_1^{'2} \nonumber\\
	(m_1 +\alpha^2 m_2) u_1^{'2} &= (m_1 +\alpha^2 m_2) v_1^{'2} \nonumber\\
	u_1^{'2} &= v_1^{'2} \nonumber\\
	u_1^{'} &= v_1^{'}
\end{align}
Substituting \autoref{eq:u2u1} into \autoref{eq:ucm} gives 
\begin{align}\label{eq:u2v1}
	u_2^{'} &= - \alpha v_1^{'}
\end{align}


\section{Connection between the LAB frame and the CM frame}
Galilean transformations describes the relationship between the LAB frame and the CM frame
\begin{align*}
	 x^{'} &= x - vt  & v_x^{'} &= v_x - V_{cm} \\
	 y^{'} &= y & v_y^{'} &= v_y \\
	 z^{'} &= z & v_z^{'} &= v_z \\
	 t^{'} &= t \\
\end{align*}

Using the same approach as \autoref{sec:LAB}. In the LAB frame of \autoref{fig:scattering}, conservation of momentum is given by
\begin{align}\label{eq:comlab}
	m_1 \boldsymbol{u}_1 + m_2 \boldsymbol{u}_2 &= m_1 \boldsymbol{v}_1 + m_2 \boldsymbol{v}_2 = (m_1 + m_2)\boldsymbol{V}
\end{align}
which can be written as
\begin{align}\label{eq:V}
	m_1 \boldsymbol{u}_1 + m_2 \boldsymbol{u}_2 &= (m_1 + m_2)\boldsymbol{V} \nonumber\\
	\boldsymbol{V} &= \frac{m_1 \boldsymbol{u}_1 + m_2 \boldsymbol{u}_2}{m_1 + m_2} & \boldsymbol{u}_2& = 0 \nonumber\\
	\boldsymbol{V} &= \frac{m_1}{m_1 + m_2} \boldsymbol{u}_1 \nonumber\\
	\boldsymbol{V} &= \frac{\alpha}{1 + \alpha} u \boldsymbol{\hat{x}} \nonumber\\
	V &= \frac{\alpha}{1 + \alpha} u
\end{align}

Using Galilean transformations, the connection between $\boldsymbol{v}_1^{'}$ and $\boldsymbol{v}_1$ is expressed as
\begin{align}\label{eq:vcmv}
	\boldsymbol{v}_1^{'} &= \boldsymbol{v}_1 - \boldsymbol{V} \nonumber\\
	\boldsymbol{v}_1 &= \boldsymbol{v}_1^{'} + \boldsymbol{V}
\end{align}
which in $x$-direction gives
\begin{align}\label{eq:vcmvx}
	v_1 \cos \theta &= v_1^{'} \cos \theta^{'} + V
\end{align}
and in $y$-direction gives
\begin{align}\label{eq:vcmvy}
	v_1 \sin \theta &= v_1^{'} \sin \theta^{'}
\end{align}
The ratio of \autoref{eq:vcmvy} and \autoref{eq:vcmvx} gives
\begin{align}\label{eq:vcmvxy}
	\frac{v_1 \sin \theta}{v_1 \cos \theta} &= \frac{v_1^{'} \sin \theta^{'}}{v_1^{'} \cos \theta^{'} + V} \nonumber\\
	\tan \theta &= \frac{\sin \theta^{'}}{\cos \theta^{'} + \frac{V}{v_1^{'}}} \nonumber\\
	\tan \theta &= \frac{\sin \theta^{'}}{\frac{V}{v_1^{'}} + \cos \theta^{'}}
\end{align}
We need to reformulate the velocity ratio. 
Substitution from \autoref{eq:u2u1} gives
\begin{align}\label{eq:Vou}
	\frac{V}{v_1^{'}} = \frac{V}{u_1^{'}}
\end{align}
Using Galilean transformation and \autoref{eq:V} we have that
\begin{align}\label{u1cm}
	\boldsymbol{u}_1^{'} &= \boldsymbol{u}_1 - \boldsymbol{V} \nonumber\\
	u_1^{'} &= u_1 - V \nonumber\\
	u_1^{'} &= u - \frac{\alpha}{1 + \alpha} u \nonumber\\
	u_1^{'} &= u \left( 1 - \frac{\alpha}{1 + \alpha} \right) \nonumber\\
	u_1^{'} &= u \left( \frac{1 + \alpha - \alpha}{1 + \alpha} \right) \nonumber\\
	u_1^{'} &= \frac{1}{1 + \alpha} u
\end{align}
Substituting \autoref{eq:V} and \autoref{u1cm} into \autoref{eq:Vou} gives
\begin{align}\label{eq:Vouea}
	\frac{V}{u_1^{'}} &= \frac{\frac{\alpha}{1 + \alpha} u}{\frac{1}{1 + \alpha} u} = \alpha
\end{align}
Substituting \autoref{eq:Vouea} into \autoref{eq:vcmvxy} gives
\begin{align}\label{eq:tanB1}
	\tan \theta &= \frac{\sin \theta^{'}}{\alpha + \cos \theta^{'}}  \nonumber\\
	\theta &= \arctan \left( \frac{\sin \theta^{'}}{\alpha + \cos \theta^{'}} \right)
\end{align}
Substituting back the variable names from the CM frame of \autoref{fig:scattering} into \autoref{eq:tanB1} gives
\begin{align}\label{eq:tanB1n}
	\theta_b &= \arctan \left( \frac{\sin \theta_b^{'}}{\alpha + \cos \theta_b^{'}} \right)
\end{align}

Using Galilean transformations, the connection between $\boldsymbol{v}_2^{'}$ and $\boldsymbol{v}_2$ is expressed as
\begin{align}\label{eq:vcmv2}
	\boldsymbol{v}_2^{'} &= \boldsymbol{v}_2 - \boldsymbol{V} \nonumber\\
	\boldsymbol{v}_2 &= \boldsymbol{v}_2^{'} + \boldsymbol{V}
\end{align}
which in $x$-direction gives
\begin{align}\label{eq:vcmvx2}
	v_2 \cos \varphi &= -v_2^{'} \cos \theta^{'} + V \nonumber\\
	v_2 \cos \varphi &= V - v_2^{'} \cos \theta^{'}
\end{align}
and in $y$-direction gives
\begin{align}\label{eq:vcmvy2}
	v_2 \sin \varphi &= v_2^{'} \sin \theta^{'}
\end{align}
The ratio of \autoref{eq:vcmvy2} and \autoref{eq:vcmvx2} gives
\begin{align}\label{eq:vcmvxy2}
	\frac{v_2 \sin \varphi}{v_2 \cos \varphi} &= \frac{v_2^{'} \sin \theta^{'}}{V - v_2^{'} \cos \theta^{'}} \nonumber\\
	\tan \varphi &= \frac{\sin \theta^{'}}{\frac{V}{v_2^{'}} - \cos \theta^{'}}
\end{align}
We need to reformulate the velocity ratio. 
Substitution from \autoref{eq:vcm} and \autoref{eq:u2u1} gives
\begin{align}\label{eq:Vou2}
	\frac{V}{v_2^{'}} &= \frac{V}{\alpha v_1^{'}} = \frac{V}{\alpha u_1^{'}}
\end{align}
Substituting \autoref{eq:Vouea} into \autoref{eq:Vou2} gives
\begin{align}\label{eq:Vouea2}
	\frac{V}{v_2^{'}} &= \frac{V}{\alpha \frac{V}{\alpha}} = 1
\end{align}
Substituting \autoref{eq:Vouea2} into \autoref{eq:vcmvxy2} gives
\begin{align}\label{eq:tanT}
	\tan \varphi &= \frac{\sin \theta^{'}}{1 - \cos \theta^{'}} = \frac{1}{\frac{1 - \cos \theta^{'}}{\sin \theta^{'}}} = \frac{1}{\tan \frac{\theta^{'}}{2}} = \cot \frac{\theta^{'}}{2} \nonumber\\
	\varphi &= \tfrac{1}{2} (\pi - \theta^{'}) ~[ \text{radians} ] = \tfrac{1}{2} (180^\circ - \theta^{'}) ~[ \text{degrees} ]
\end{align}
Substituting back the variable names from \autoref{fig:scattering} into \autoref{eq:tanT} gives
\begin{align}\label{eq:tanTgen}
	\theta_t &= \tfrac{1}{2} (\pi - \theta_b^{'}) ~[ \text{radians} ] = \tfrac{1}{2} (180^\circ - \theta_b^{'}) ~[ \text{degrees} ]
\end{align}


% ----------------------------------------------------------------------------------------------------------------------% ----------------------------------------------------------------------------------------------------------------------

\chapter{Computer setup and environment}\label{a:computer_environment}
Some calibration code is based on the codes of Ville Virtanen and Dr. Liam Gaffney. Other code/scripts have been written by the author in C++ / Python.

\section{The computer}
The \textsl{MiniballCoulexSort} code does not require any a lot of computing power to run. \autoref{tab:PC} shows the computer with specifications used for the sorting and data analysis. Since the data from the experiment takes up about 60 GB, the limitation was with the SSD\footnote{The SSD (solid-state drive) is the internal storage device in the computer.}. When running the sorting and event-building programs, the space on the computer rapidly vanishes. 

\begin{table}[ht] 
	\centering 
	\caption{Computer used for sorting and data analysis.}
	\label{tab:PC}
	\begin{tabular}{ll}
		\hline
		Model & MacBook Air (13-inch, 2017) \\
		\hline
		OS              & macOS High Sierra (Version 10.13.6) \\
		Processor  &  1.8 GHz (Intel Core i5, dual core, 4 threads)  \\
						 &  Max turbo frequency: 2.90 Ghz  \\
		Memory     &  8 GB (1600 MHz DDR3)  \\
		SSD		     &  128 GB  \\
		\hline
	\end{tabular}
\end{table}


\section{The environment}
\subsubsection*{\textcolor{red}{Nevn den relative mappestrukturen, slik at terminal-commandoer gir mening. Både for Miniball kode og ROOT framework.}}

The relative path of \textsl{MiniballCoulexSort} is
\begin{lstlisting}[language=sh]
~/GitHub/Miniball/MiniballCoulexSort
\end{lstlisting}
The relative path of \texttt{kinsim3} is
\begin{lstlisting}[language=sh]
~/GitHub/Miniball/kinsim
\end{lstlisting}
The relative path of the ROOT framework is
\begin{lstlisting}[language=sh]
~/GitHub/ROOT-framework/build
\end{lstlisting}


\subsection{Relative path of programs, scripts and files}
\autoref{tab:paths} shows the relative path of programs, scripts and files used in this thesis. 
The settingsfile \textit{MBSettings2017\_CLX\_IS558.dat}, and calibration files \textit{IS558-online.cal} and \textit{IS558-user.cal}, used in this experiment can be found in the directory specified in the table, but when used directly with \textsl{MiniballCoulexSort} the default path is \textit{$\sim$/GitHub/Miniball/MiniballCoulexSort/config}.
The file \textit{setup\_Sm.txt} is in the table twice, this is because it is two files with the same name, one for plotting and one for fitting.

\begin{table}[ht]
    \centering
    \caption{Relative path of programs, scripts and files.}
	\input{Table-data/Paths.tex}
	\label{tab:paths}
\end{table}


\section{Run time}

\subsubsection{\textcolor{red}{TODO: Run timing on \texttt{M2R.sh}}}

\begin{table}[ht] 
	\centering 
	\caption{Run time for building event trees. The run time of the bash scripts was timed with the built in command line script named \texttt{time}. It depends on the number of files added for tree building.}
	\label{tab:run_time}
	\begin{tabular}{ll}
		\hline
		Executable   &  Run time [min] \\
		\hline
		TreeBuilder  &  $\sim$ 45   \\
		AQ4Sort       &  $\sim$ 130  \\
		\hline
	\end{tabular}
\end{table}

\section{Script usage?}

\texttt{ParticleFit.cpp} \newline
Function 
\begin{lstlisting}[language=c++]
void AQ4_fit(std::string setup_file, 
	std::string detector_side, int ring_gate = 1, 
	bool help_lines = false)
\end{lstlisting}



\section{Connecting MiniballCoulexSort with ROOT}
To connect MiniballCoulexSort with ROOT you need them to share their libraries with each other. This is done with a dynamic loader, which you can find out more about here \cite{ROOTdynLoader}. 

You have to make a \textit{.rootrc} file in your home folder on your computer. In the \textit{.rootrc} file you want to write something like this 
\begin{lstlisting}[language=]
Unix.*.Root.DynamicPath:    .:</Users/trondwj/GitHub/ROOT-framework/build/lib>:/Users/trondwj/GitHub/Miniball/MiniballCoulexSort/lib:
\end{lstlisting}
This should all be in one line. The first part is to tell the system to use the dynamic loader of ROOT to connect the given paths that follow. In my case the lib folder of the ROOT install was at 
\begin{lstlisting}[language=]
/Users/trondwj/GitHub/ROOT-framework/build/lib
\end{lstlisting}
and the lib folder of the \textsl{MiniballCoulexSort} was at
\begin{lstlisting}[language=]
/Users/trondwj/GitHub/Miniball/MiniballCoulexSort/lib
\end{lstlisting}
These paths are totally individual, and you will probably not have it in the same place. Therefore these paths must be changed to fit your system. 

After making the file you either have restart the terminal or you can source the file by writing this in the terminal
\begin{lstlisting}[language=sh]
$ source ~/.rootrc
\end{lstlisting}



\section{Running ROOT and MiniballCoulexSort from anywhere in the terminal}
To run ROOT or the different scripts of \textsl{MiniballCoulexSort} anywhere in the terminal, you have to edit your \textit{.bash\_profile} file [\textit{.bash\_profile} on MacOS, \textit{.bashrc} on Linux]. In the \textit{.bash\_profile} the following commands were used 
\begin{lstlisting}[language=sh]
# Run ROOT from anywhere
export ROOTSYS=$HOME/GitHub/ROOT-framework/build
export PATH=$ROOTSYS/lib:$PATH
export PATH=$ROOTSYS/bin:$PATH
export DYLD_LIBRARY_PATH=$ROOTSYS/lib:$DYLD_LIBRARY_PATH

# Run MiniballCoulexSort from anywhere
export DYLD_LIBRARY_PATH=$HOME/GitHub/Miniball/MiniballCoulexSort/lib:$DYLD_LIBRARY_PATH
export PATH=$HOME/GitHub/Miniball/MiniballCoulexSort/lib:$PATH
export PATH=$HOME/GitHub/Miniball/MiniballCoulexSort/bin:$PATH
\end{lstlisting}
The DYLD\_LIBRARY\_PATH is used on Mac only. On other systems, use \newline LD\_LIBRARY\_PATH instead. You need to locate the \textit{lib} and \textit{bin} folders for both ROOT and \textsl{MiniballCoulexSort} and change them to fit your system, and in addition you need the build folder of your ROOT install.


% ----------------------------------------------------------------------------------------------------------------------% ----------------------------------------------------------------------------------------------------------------------

\chapter{Miniball wiring}

\section{CD wiring and naming of histograms}

\begin{table}[ht] 
	\centering 
	\caption{CD wiring for Coulomb excitation experiments.}
	\input{Table-data/ADC.tex}
	\label{tab:ADC}
\end{table}


\begin{table}[ht] 
	\centering 
	\caption{The logic counting and the naming of histograms from \texttt{TreeBuilder} and \texttt{AQ4Sort}.}
	\input{Table-data/TBvsAQ4.tex}
	\label{tab:TBvsAQ4}
\end{table}



% ----------------------------------------------------------------------------------------------------------------------% ----------------------------------------------------------------------------------------------------------------------


\chapter{CD simulation}\label{ch:cd_sim}
On the next page, the CD simulation is showed for each ring. Ring 1 is the innermost ring and ring 16 is the outermost ring. The plots show simulated counts vs. energy, where the first peak (lower energy) is the \Pb\ and the second peak (higher energy) is \Sm. The plots were grabbed from the \textit{.root}-file by the commands

\begin{lstlisting}[language=sh]
$ cd ~/GitHub/MasterThesis/Scripts/plotting
$ root
root [0] .L ParticlePlot.cpp++
root [1] simulation_plot("setup_Sm.txt", 0)
... <showing output from script>
\end{lstlisting}

The next page after that shows the fitting of the CD simulation, where the red dotted curves shows the fitting of the peaks and the vertical black dotted lines shows the centroids of the peaks.

\begin{lstlisting}[language=sh]
$ cd ~/GitHub/MasterThesis/Scripts/fitting
$ root
root [0] .L ParticleFit.cpp++
root [1] simulation_fit("setup_Sm.txt")
... <showing output from script>
\end{lstlisting}

For the Si dead layer in \texttt{kinsim3}, the SRIM files must have units of MeV/mm. 
If units of MeV/cm$^2$ are used, the distance on line 359 in \texttt{kinsim3} needs to be changed to the correct units. 
The correction factor is at the bottom of the SRIM file.
Line 358 and 359 in \texttt{kinsim3} reads
\begin{lstlisting}[language=c++]
// Correct for dead layer loss
dist = TMath::Abs( 0.0007 / TMath::Cos( TTh ) );
\end{lstlisting}
where the factor needs to be changed.


\includepdf[pages={-}, angle=270]{../Plots/simulation/cd_sim_all.pdf}

\includepdf[pages={-}, angle=270]{../Plots/fitting/Pb_Sm_sim.pdf}


\end{appendices}

% ----------------------------------------------------------------------------------------------------------------------% ----------------------------------------------------------------------------------------------------------------------

%\bibliographystyle{unsrtnat}
\bibliographystyle{mybibstyle} %my own bibstyle to set first names to one letter + unsrtnat

\bibliography{/Users/trondwj/GitHub/MasterThesis/Thesis/References/Mendeley.bib,/Users/trondwj/GitHub/MasterThesis/Thesis/References/web_references.bib}


\end{document}